import{d as a,D as e,x as l,h as s,r as t,g as c,z as u,y as n,o as i,c as d,w as r,a as o,b as f,t as v,l as m,B as _,F as y,s as p,i as b,e as k,I as h,v as g,f as w,_ as x}from"./index-ClZek067.js";const I=x(a({__name:"index",setup(a){const x=e(),{blacklistMachines:I,selectedSoftware:V}=l(x),C=s((()=>x.loading.blacklistMachines)),M=s((()=>I.value)),B=t(!1),P=[{label:"机器码 (2)",value:2},{label:"IP (1)",value:1},{label:"其他 (0)",value:0}],U=c({value:"",typeIndex:0,remark:""});function j(a){U.typeIndex=Number(a.detail.value)||0}async function z(){await x.loadBlacklistMachines()}async function D(){await z()}function F(a){const e=P.find((e=>e.value===a));return e?e.label.replace(/ \(\d+\)/,""):"其他"}async function N(){var a;if(U.value.trim()){B.value=!0;try{await x.createBlacklistMachine({value:U.value.trim(),type:(null==(a=P[U.typeIndex])?void 0:a.value)??2,remarks:U.remark.trim()||void 0}),U.value="",U.remark="",p({title:"已加入黑名单",icon:"success"})}catch(e){console.error("create blacklist machine error",e),p({title:"操作失败",icon:"none"})}finally{B.value=!1}}else p({title:"请输入机器码",icon:"none"})}return u((async()=>{await x.ensureReady(),await z()})),n((()=>V.value),(async(a,e)=>{a&&a!==e&&await z()})),(a,e)=>{const l=b,s=k,t=h,c=g,u=w;return i(),d(s,{class:"page"},{default:r((()=>[o(s,{class:"header glass-card"},{default:r((()=>[o(s,null,{default:r((()=>[o(l,{class:"title"},{default:r((()=>[f("黑名单机器码")])),_:1}),o(l,{class:"subtitle"},{default:r((()=>[f("维护需要封禁的机器码或 IP 列表")])),_:1})])),_:1}),o(s,{class:"form"},{default:r((()=>[o(t,{class:"input",placeholder:"输入机器码或唯一值",modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=a=>U.value=a)},null,8,["modelValue"]),o(c,{mode:"selector",range:P.map((a=>a.label)),value:U.typeIndex,onChange:j},{default:r((()=>[o(s,{class:"picker-display"},{default:r((()=>[f(v(P[U.typeIndex].label),1)])),_:1})])),_:1},8,["range","value"]),o(t,{class:"input",placeholder:"备注（可选）",modelValue:U.remark,"onUpdate:modelValue":e[1]||(e[1]=a=>U.remark=a)},null,8,["modelValue"]),o(u,{class:"btn primary",disabled:!U.value.trim()||B.value,onClick:N},{default:r((()=>[f(v(B.value?"提交中...":"加入黑名单"),1)])),_:1},8,["disabled"]),o(u,{class:"btn ghost",disabled:C.value,onClick:D},{default:r((()=>[f("刷新列表")])),_:1},8,["disabled"])])),_:1})])),_:1}),o(s,{class:"list glass-card"},{default:r((()=>[C.value?(i(),d(s,{key:0,class:"empty"},{default:r((()=>[f("数据加载中...")])),_:1})):M.value.length?(i(),d(s,{key:2,class:"items"},{default:r((()=>[(i(!0),m(y,null,_(M.value,(a=>(i(),d(s,{key:a.value,class:"item glass-light"},{default:r((()=>[o(s,{class:"row"},{default:r((()=>[o(l,{class:"label"},{default:r((()=>[f("值")])),_:1}),o(l,{class:"value highlight"},{default:r((()=>[f(v(a.value),1)])),_:2},1024)])),_:2},1024),o(s,{class:"row"},{default:r((()=>[o(l,{class:"label"},{default:r((()=>[f("类型")])),_:1}),o(l,{class:"value"},{default:r((()=>[f(v(F(a.type)),1)])),_:2},1024)])),_:2},1024),o(s,{class:"row"},{default:r((()=>[o(l,{class:"label"},{default:r((()=>[f("备注")])),_:1}),o(l,{class:"value"},{default:r((()=>[f(v(a.remarks||"-"),1)])),_:2},1024)])),_:2},1024),o(u,{class:"btn danger",onClick:e=>async function(a){if(a)try{await x.deleteBlacklistMachines([a]),p({title:"已删除",icon:"success"})}catch(e){console.error("delete blacklist machine error",e),p({title:"删除失败",icon:"none"})}}(a.value)},{default:r((()=>[f("删除")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})):(i(),d(s,{key:1,class:"empty"},{default:r((()=>[f("当前软件暂无黑名单记录")])),_:1}))])),_:1})])),_:1})}}}),[["__scopeId","data-v-b89908f4"]]);export{I as default};

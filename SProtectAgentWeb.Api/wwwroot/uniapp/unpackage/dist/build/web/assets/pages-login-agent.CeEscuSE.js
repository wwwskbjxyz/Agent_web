import{d as e,u as a,r as l,g as s,h as t,o,c as u,w as n,a as d,b as i,j as r,k as c,l as m,F as f,t as p,s as g,m as w,p as _,n as v,q as h,i as b,e as V,f as y,I as C,_ as k}from"./index-HILlddLG.js";const A=k(e({__name:"agent",setup(e){const k=a(),A=l("login"),x=s({account:"",username:"",email:"",password:"",softwareCode:"",authorAccount:"",authorPassword:""}),P=l(!1),U=t((()=>"login"===A.value?k.loading.loginAgent:k.loading.registerAgent)),W=t((()=>k.loading.loginAgentWeChat));async function j(){var e;if("register"===A.value){if(!(x.username&&x.email&&x.password&&x.softwareCode&&x.authorAccount&&x.authorPassword))return void g({title:"请完整填写注册信息",icon:"none"});try{return await k.registerAgent({username:x.username.trim(),email:x.email.trim(),password:x.password,softwareCode:x.softwareCode.trim().toUpperCase(),authorAccount:x.authorAccount.trim(),authorPassword:x.authorPassword}),g({title:"注册成功，请登录",icon:"success"}),x.account=x.email.trim(),x.password="",x.softwareCode="",x.authorAccount="",x.authorPassword="",void(A.value="login")}catch(a){const e=(null==a?void 0:a.message)&&"string"==typeof a.message?a.message:"注册失败，请稍后重试";return void g({title:e,icon:"none"})}}if(x.account&&x.password)try{const a=await k.loginAgent({account:x.account.trim(),password:x.password});(null==(e=null==a?void 0:a.bindings)?void 0:e.length)?w({url:"/pages/index/index"}):_({title:"登录成功",content:"您还没有绑定任何作者软件码，是否现在绑定？",success(e){e.confirm?v({url:"/pages/agent/bind"}):w({url:"/pages/index/index"})}})}catch(a){const e=(null==a?void 0:a.message)&&"string"==typeof a.message?a.message:"操作失败，请稍后重试";g({title:e,icon:"none"})}else g({title:"请完整填写信息",icon:"none"})}function I(){w({url:"/pages/login/index"})}async function q(){if(P.value){if(!W.value)try{const e=await new Promise(((e,a)=>{h({provider:"weixin",onlyAuthorize:!0,success:l=>{l.code?e(l.code):a(new Error("未获取到登录凭证"))},fail:e=>a(e)})}));await k.loginAgentWithWeChat(e),w({url:"/pages/index/index"})}catch(e){const a=(null==e?void 0:e.errMsg)||(null==e?void 0:e.message)||"微信登录失败，请稍后再试";g({title:a,icon:"none"})}}else g({title:"请在微信小程序内使用微信登录",icon:"none"})}return(e,a)=>{const l=b,s=V,t=y,g=C;return o(),u(s,{class:"page"},{default:n((()=>[d(s,{class:"glass-card card"},{default:n((()=>[d(s,{class:"header"},{default:n((()=>[d(l,{class:"badge"},{default:n((()=>[i("代理中心")])),_:1}),d(l,{class:"title"},{default:n((()=>[i("登录 / 注册代理账号")])),_:1}),d(l,{class:"subtitle"},{default:n((()=>[i(" 默认展示登录表单，可通过上方标签切换至注册。注册仅需一次，需填写邮箱并绑定首个软件码，后续即可在此直接登录使用。 ")])),_:1})])),_:1}),d(s,{class:"tabs"},{default:n((()=>[d(t,{class:r(["tab","login"===A.value?"active":""]),onClick:a[0]||(a[0]=e=>A.value="login")},{default:n((()=>[i("登录")])),_:1},8,["class"]),d(t,{class:r(["tab","register"===A.value?"active":""]),onClick:a[1]||(a[1]=e=>A.value="register")},{default:n((()=>[i("注册")])),_:1},8,["class"])])),_:1}),d(s,{class:"form"},{default:n((()=>["login"===A.value?(o(),u(s,{key:0,class:"form-item"},{default:n((()=>[d(l,{class:"label"},{default:n((()=>[i("用户名 / 邮箱")])),_:1}),d(g,{modelValue:x.account,"onUpdate:modelValue":a[2]||(a[2]=e=>x.account=e),class:"input",placeholder:"请输入用户名或邮箱","keyboard-type":"email"},null,8,["modelValue"])])),_:1})):(o(),u(s,{key:1,class:"form-item"},{default:n((()=>[d(l,{class:"label"},{default:n((()=>[i("用户名")])),_:1}),d(g,{modelValue:x.username,"onUpdate:modelValue":a[3]||(a[3]=e=>x.username=e),class:"input",placeholder:"用于登录与展示"},null,8,["modelValue"])])),_:1})),"register"===A.value?(o(),u(s,{key:2,class:"form-item"},{default:n((()=>[d(l,{class:"label"},{default:n((()=>[i("邮箱")])),_:1}),d(g,{modelValue:x.email,"onUpdate:modelValue":a[4]||(a[4]=e=>x.email=e),class:"input",placeholder:"接收通知与找回密码","keyboard-type":"email"},null,8,["modelValue"])])),_:1})):c("",!0),d(s,{class:"form-item"},{default:n((()=>[d(l,{class:"label"},{default:n((()=>[i("密码")])),_:1}),d(g,{modelValue:x.password,"onUpdate:modelValue":a[5]||(a[5]=e=>x.password=e),class:"input",placeholder:"至少 6 位密码",password:""},null,8,["modelValue"])])),_:1}),"register"===A.value?(o(),m(f,{key:3},[d(s,{class:"form-item"},{default:n((()=>[d(l,{class:"label"},{default:n((()=>[i("绑定软件码")])),_:1}),d(g,{modelValue:x.softwareCode,"onUpdate:modelValue":a[6]||(a[6]=e=>x.softwareCode=e),class:"input",placeholder:"请输入作者提供的软件码"},null,8,["modelValue"])])),_:1}),d(s,{class:"form-item"},{default:n((()=>[d(l,{class:"label"},{default:n((()=>[i("作者账号")])),_:1}),d(g,{modelValue:x.authorAccount,"onUpdate:modelValue":a[7]||(a[7]=e=>x.authorAccount=e),class:"input",placeholder:"用于转发到作者端的账号"},null,8,["modelValue"])])),_:1}),d(s,{class:"form-item"},{default:n((()=>[d(l,{class:"label"},{default:n((()=>[i("作者密码")])),_:1}),d(g,{modelValue:x.authorPassword,"onUpdate:modelValue":a[8]||(a[8]=e=>x.authorPassword=e),class:"input",placeholder:"用于转发到作者端的密码",password:""},null,8,["modelValue"])])),_:1})],64)):c("",!0)])),_:1}),d(t,{class:"submit",disabled:U.value,onClick:j},{default:n((()=>[i(p("login"===A.value?U.value?"登录中...":"立即登录":U.value?"注册中...":"完成注册"),1)])),_:1},8,["disabled"]),d(s,{class:"extra"},{default:n((()=>[d(t,{class:"link",onClick:I},{default:n((()=>[i("返回入口")])),_:1}),d(t,{class:"link primary",disabled:W.value,onClick:q},{default:n((()=>[i(p(W.value?"微信登录中...":"微信快捷登录"),1)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-78ba9f9a"]]);export{A as default};

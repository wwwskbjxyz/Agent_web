import{d as e,u as a,r as l,g as s,h as t,o as u,c as o,w as d,a as i,b as r,j as n,k as c,t as m,s as p,m as f,i as g,e as v,f as _,I as b,v as y,_ as h}from"./index-fvgcSFN3.js";const w=h(e({__name:"author",setup(e){const h=a(),w=l("login"),V=l(null),k=s({account:"",username:"",email:"",password:"",displayName:"",apiAddress:"",apiPort:8080,softwareType:"SP"}),P=[{value:"SP",label:"SProtect (默认)"},{value:"QP",label:"QProtect"},{value:"API",label:"自定义 API"}],A=t((()=>P.find((e=>e.value===k.softwareType))??P[0])),N=t((()=>"login"===w.value?h.loading.loginAuthor:h.loading.registerAuthor));function U(e){const a=Number(e.detail.value??0),l=P[a]??P[0];k.softwareType=l.value}async function C(){if("register"===w.value){if(!(k.username&&k.email&&k.password&&k.displayName&&k.apiAddress))return void p({title:"请完整填写注册信息",icon:"none"});try{const e=await h.registerAuthor({username:k.username.trim(),email:k.email.trim(),password:k.password,displayName:k.displayName.trim(),apiAddress:k.apiAddress.trim(),apiPort:k.apiPort,softwareType:k.softwareType});return V.value=e,p({title:"注册成功，请登录",icon:"success"}),k.account=k.email.trim(),k.password="",void(w.value="login")}catch(e){const a=(null==e?void 0:e.message)&&"string"==typeof e.message?e.message:"操作失败，请稍后重试";return void p({title:a,icon:"none"})}}if(k.account&&k.password)try{const e=await h.loginAuthor({account:k.account.trim(),password:k.password});V.value=e,p({title:"登录成功",icon:"success"}),await h.fetchAuthorProfile(),f({url:"/pages/author/dashboard"})}catch(e){const a=(null==e?void 0:e.message)&&"string"==typeof e.message?e.message:"操作失败，请稍后重试";p({title:a,icon:"none"})}else p({title:"请完整填写信息",icon:"none"})}function I(){f({url:"/pages/login/index"})}return(e,a)=>{const l=g,s=v,t=_,p=b,f=y;return u(),o(s,{class:"page"},{default:d((()=>[i(s,{class:"glass-card card"},{default:d((()=>[i(s,{class:"header"},{default:d((()=>[i(l,{class:"badge"},{default:d((()=>[r("作者管理")])),_:1}),i(l,{class:"title"},{default:d((()=>[r("注册 / 登录作者端")])),_:1}),i(l,{class:"subtitle"},{default:d((()=>[r(" 默认展示登录表单，可通过上方标签在“登录”和“注册”之间切换。完成注册后即可在此处直接登录并管理您的软件码。 ")])),_:1})])),_:1}),i(s,{class:"tabs"},{default:d((()=>[i(t,{class:n(["tab","login"===w.value?"active":""]),onClick:a[0]||(a[0]=e=>w.value="login")},{default:d((()=>[r("登录")])),_:1},8,["class"]),i(t,{class:n(["tab","register"===w.value?"active":""]),onClick:a[1]||(a[1]=e=>w.value="register")},{default:d((()=>[r("注册")])),_:1},8,["class"])])),_:1}),i(s,{class:"form"},{default:d((()=>["login"===w.value?(u(),o(s,{key:0,class:"form-item"},{default:d((()=>[i(l,{class:"label"},{default:d((()=>[r("用户名 / 邮箱")])),_:1}),i(p,{modelValue:k.account,"onUpdate:modelValue":a[2]||(a[2]=e=>k.account=e),class:"input",placeholder:"请输入用户名或邮箱"},null,8,["modelValue"])])),_:1})):(u(),o(s,{key:1,class:"form-item"},{default:d((()=>[i(l,{class:"label"},{default:d((()=>[r("用户名")])),_:1}),i(p,{modelValue:k.username,"onUpdate:modelValue":a[3]||(a[3]=e=>k.username=e),class:"input",placeholder:"设置作者登录用户名"},null,8,["modelValue"])])),_:1})),"register"===w.value?(u(),o(s,{key:2,class:"form-item"},{default:d((()=>[i(l,{class:"label"},{default:d((()=>[r("邮箱")])),_:1}),i(p,{modelValue:k.email,"onUpdate:modelValue":a[4]||(a[4]=e=>k.email=e),class:"input",placeholder:"接收通知与找回密码的邮箱"},null,8,["modelValue"])])),_:1})):c("",!0),i(s,{class:"form-item"},{default:d((()=>[i(l,{class:"label"},{default:d((()=>[r("密码")])),_:1}),i(p,{modelValue:k.password,"onUpdate:modelValue":a[5]||(a[5]=e=>k.password=e),class:"input",placeholder:"至少 6 位密码",password:""},null,8,["modelValue"])])),_:1}),"register"===w.value?(u(),o(s,{key:3,class:"form-item"},{default:d((()=>[i(l,{class:"label"},{default:d((()=>[r("展示名称")])),_:1}),i(p,{modelValue:k.displayName,"onUpdate:modelValue":a[6]||(a[6]=e=>k.displayName=e),class:"input",placeholder:"作者昵称或公司名"},null,8,["modelValue"])])),_:1})):c("",!0),"register"===w.value?(u(),o(s,{key:4,class:"form-item"},{default:d((()=>[i(l,{class:"label"},{default:d((()=>[r("接口地址")])),_:1}),i(p,{modelValue:k.apiAddress,"onUpdate:modelValue":a[7]||(a[7]=e=>k.apiAddress=e),class:"input",placeholder:"部署主机 IP 或域名"},null,8,["modelValue"])])),_:1})):c("",!0),"register"===w.value?(u(),o(s,{key:5,class:"form-item"},{default:d((()=>[i(l,{class:"label"},{default:d((()=>[r("接口端口")])),_:1}),i(p,{modelValue:k.apiPort,"onUpdate:modelValue":a[8]||(a[8]=e=>k.apiPort=e),modelModifiers:{number:!0},class:"input",type:"number",placeholder:"如：8080"},null,8,["modelValue"])])),_:1})):c("",!0),"register"===w.value?(u(),o(s,{key:6,class:"form-item"},{default:d((()=>[i(l,{class:"label"},{default:d((()=>[r("软件类型")])),_:1}),i(f,{range:P,"range-key":"label",onChange:U},{default:d((()=>[i(s,{class:"picker"},{default:d((()=>[r(m(A.value.label),1)])),_:1})])),_:1})])),_:1})):c("",!0)])),_:1}),i(t,{class:"submit",disabled:N.value,onClick:C},{default:d((()=>[r(m("login"===w.value?N.value?"登录中...":"立即登录":N.value?"注册中...":"提交注册"),1)])),_:1},8,["disabled"]),"login"===w.value&&V.value?(u(),o(s,{key:0,class:"hint"},{default:d((()=>[i(l,null,{default:d((()=>[r("软件码："+m(V.value.softwareCode),1)])),_:1}),i(l,null,{default:d((()=>[r("接口："+m(V.value.apiAddress)+":"+m(V.value.apiPort),1)])),_:1})])),_:1})):c("",!0),i(t,{class:"link",onClick:I},{default:d((()=>[r("返回入口")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-903980a6"]]);export{w as default};

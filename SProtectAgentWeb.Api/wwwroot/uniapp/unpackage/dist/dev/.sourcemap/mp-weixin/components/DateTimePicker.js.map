{"version":3,"file":"DateTimePicker.js","sources":["components/DateTimePicker.vue","E:/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/QzovVXNlcnMvQWRtaW5pc3RyYXRvci9zb3VyY2UvcmVwb3Mvd3d3c2tianh5ei9TUFRFU1QtVjEvU1Byb3RlY3RBZ2VudFdlYi5BcGkvd3d3cm9vdC91bmlhcHAvY29tcG9uZW50cy9EYXRlVGltZVBpY2tlci52dWU"],"sourcesContent":["<template>\r\n  <view class=\"picker-wrapper\">\r\n    <picker\r\n      mode=\"multiSelector\"\r\n      :range=\"rangeColumns\"\r\n      :value=\"columnIndex\"\r\n      @change=\"onChange\"\r\n      @columnchange=\"onColumnChange\"\r\n    >\r\n      <view class=\"picker-display\" :class=\"{ placeholder: !displayValue }\">\r\n        {{ displayValue || placeholder }}\r\n      </view>\r\n    </picker>\r\n    <button v-if=\"clearable && modelValue\" class=\"clear-btn\" @tap.stop=\"clearValue\">清除</button>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, ref, watch } from 'vue';\r\n\r\ninterface ColumnChangeDetail {\r\n  column: number;\r\n  value: number;\r\n}\r\n\r\nconst props = withDefaults(\r\n  defineProps<{\r\n    modelValue?: string;\r\n    placeholder?: string;\r\n    clearable?: boolean;\r\n    startYear?: number;\r\n    endYear?: number;\r\n  }>(),\r\n  {\r\n    modelValue: '',\r\n    placeholder: '请选择时间',\r\n    clearable: true,\r\n    startYear: undefined,\r\n    endYear: undefined\r\n  }\r\n);\r\n\r\nconst emit = defineEmits<{\r\n  (e: 'update:modelValue', value: string): void;\r\n  (e: 'change', value: string): void;\r\n}>();\r\n\r\nconst now = new Date();\r\nconst columnIndex = ref<[number, number, number, number, number]>([0, 0, 0, 0, 0]);\r\nconst yearOptions = ref<number[]>([]);\r\nconst dayOptions = ref<number[]>([]);\r\n\r\nconst months = Array.from({ length: 12 }, (_, index) => index + 1);\r\nconst hours = Array.from({ length: 24 }, (_, index) => index);\r\nconst minutes = Array.from({ length: 60 }, (_, index) => index);\r\n\r\nconst rangeColumns = computed(() => [\r\n  yearOptions.value.map((value) => `${value}年`),\r\n  months.map((value) => `${value.toString().padStart(2, '0')}月`),\r\n  dayOptions.value.map((value) => `${value.toString().padStart(2, '0')}日`),\r\n  hours.map((value) => `${value.toString().padStart(2, '0')}时`),\r\n  minutes.map((value) => `${value.toString().padStart(2, '0')}分`)\r\n]);\r\n\r\nconst displayValue = computed(() => {\r\n  const value = props.modelValue?.trim();\r\n  if (!value) {\r\n    return '';\r\n  }\r\n  const normalized = value.replace('T', ' ').replace(/\\//g, '-');\r\n  if (/^\\d{4}-\\d{2}-\\d{2}\\s\\d{2}:\\d{2}$/.test(normalized)) {\r\n    return normalized;\r\n  }\r\n  const parsed = new Date(normalized);\r\n  if (Number.isNaN(parsed.getTime())) {\r\n    return '';\r\n  }\r\n  return formatValue(parsed.getFullYear(), parsed.getMonth() + 1, parsed.getDate(), parsed.getHours(), parsed.getMinutes());\r\n});\r\n\r\nfunction formatValue(year: number, month: number, day: number, hour: number, minute: number) {\r\n  const pad = (input: number) => input.toString().padStart(2, '0');\r\n  return `${year}-${pad(month)}-${pad(day)} ${pad(hour)}:${pad(minute)}`;\r\n}\r\n\r\nfunction resolveYearRange(targetYear: number) {\r\n  const current = now.getFullYear();\r\n  const start = props.startYear ?? current - 5;\r\n  const end = props.endYear ?? current + 5;\r\n  const min = Math.min(start, targetYear);\r\n  const max = Math.max(end, targetYear);\r\n  const years: number[] = [];\r\n  for (let year = min; year <= max; year += 1) {\r\n    years.push(year);\r\n  }\r\n  yearOptions.value = years;\r\n}\r\n\r\nfunction updateDayOptions(year: number, month: number) {\r\n  const daysInMonth = new Date(year, month, 0).getDate();\r\n  dayOptions.value = Array.from({ length: daysInMonth }, (_, index) => index + 1);\r\n}\r\n\r\nfunction syncFromValue(value?: string) {\r\n  const base = value?.trim();\r\n  let target = new Date(base ? base.replace('T', ' ') : '');\r\n  if (!base || Number.isNaN(target.getTime())) {\r\n    target = now;\r\n  }\r\n\r\n  resolveYearRange(target.getFullYear());\r\n  const yearIndex = Math.max(0, yearOptions.value.findIndex((item) => item === target.getFullYear()));\r\n  updateDayOptions(yearOptions.value[yearIndex] ?? target.getFullYear(), target.getMonth() + 1);\r\n\r\n  const nextIndex: [number, number, number, number, number] = [\r\n    yearIndex,\r\n    Math.max(0, target.getMonth()),\r\n    Math.max(0, Math.min(dayOptions.value.length - 1, target.getDate() - 1)),\r\n    Math.max(0, target.getHours()),\r\n    Math.max(0, target.getMinutes())\r\n  ];\r\n  columnIndex.value = nextIndex;\r\n}\r\n\r\nfunction emitValue(indexes: number[]) {\r\n  const [yearIdx, monthIdx, dayIdx, hourIdx, minuteIdx] = indexes;\r\n  const year = yearOptions.value[yearIdx] ?? yearOptions.value[0];\r\n  const month = months[monthIdx] ?? months[0];\r\n  updateDayOptions(year, month);\r\n  const day = dayOptions.value[dayIdx] ?? dayOptions.value[dayOptions.value.length - 1] ?? 1;\r\n  const hour = hours[hourIdx] ?? 0;\r\n  const minute = minutes[minuteIdx] ?? 0;\r\n  const formatted = formatValue(year, month, day, hour, minute);\r\n  emit('update:modelValue', formatted);\r\n  emit('change', formatted);\r\n}\r\n\r\nfunction onChange(event: UniApp.MultiSelectorPickerChangeEvent) {\r\n  const indexes = event.detail.value as number[];\r\n  if (!Array.isArray(indexes) || indexes.length < 5) {\r\n    return;\r\n  }\r\n  columnIndex.value = [indexes[0], indexes[1], indexes[2], indexes[3], indexes[4]];\r\n  emitValue(indexes);\r\n}\r\n\r\nfunction onColumnChange(event: { detail: ColumnChangeDetail }) {\r\n  const { column, value } = event.detail;\r\n  const next = [...columnIndex.value] as number[];\r\n  next[column] = value;\r\n  if (column === 0 || column === 1) {\r\n    const year = yearOptions.value[next[0]] ?? yearOptions.value[0];\r\n    const month = months[next[1]] ?? months[0];\r\n    updateDayOptions(year, month);\r\n    if (next[2] >= dayOptions.value.length) {\r\n      next[2] = Math.max(0, dayOptions.value.length - 1);\r\n    }\r\n  }\r\n  columnIndex.value = [next[0], next[1], next[2], next[3], next[4]];\r\n}\r\n\r\nfunction clearValue() {\r\n  emit('update:modelValue', '');\r\n  emit('change', '');\r\n}\r\n\r\nwatch(\r\n  () => props.modelValue,\r\n  (value) => {\r\n    syncFromValue(value);\r\n  },\r\n  { immediate: true }\r\n);\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.picker-wrapper {\r\n  position: relative;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.picker-display {\r\n  width: 100%;\r\n  padding: 20rpx 24rpx;\r\n  border-radius: 18rpx;\r\n  background: rgba(15, 23, 42, 0.55);\r\n  border: 1rpx solid rgba(59, 130, 246, 0.15);\r\n  color: #e2e8f0;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.picker-display.placeholder {\r\n  color: rgba(148, 163, 184, 0.65);\r\n}\r\n\r\n.clear-btn {\r\n  position: absolute;\r\n  right: 16rpx;\r\n  padding: 8rpx 18rpx;\r\n  border-radius: 999rpx;\r\n  border: none;\r\n  background: rgba(15, 23, 42, 0.68);\r\n  color: rgba(148, 163, 184, 0.78);\r\n  font-size: 22rpx;\r\n}\r\n</style>\r\n","import Component from 'C:/Users/Administrator/source/repos/wwwskbjxyz/SPTEST-V1/SProtectAgentWeb.Api/wwwroot/uniapp/components/DateTimePicker.vue'\nwx.createComponent(Component)"],"names":["ref","computed","watch"],"mappings":"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"}
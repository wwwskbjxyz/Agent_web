{"version":3,"file":"settlement.js","sources":["pages/agent/settlement.vue","E:/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWdlbnQvc2V0dGxlbWVudC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <view v-if=\"!platformStore.isAuthenticated\" class=\"empty\">\r\n      <text>请先登录代理账号后再管理结算设置。</text>\r\n      <button class=\"link\" @tap=\"goLogin\">前往登录</button>\r\n    </view>\r\n    <scroll-view v-else scroll-y class=\"content\">\r\n      <view class=\"section\">\r\n        <view class=\"section-header\">\r\n          <view class=\"section-titles\">\r\n            <text class=\"section-title\">结算设置</text>\r\n            <text class=\"section-subtitle\">为不同卡密类型配置结算价格，销量查询将自动计算总额。</text>\r\n          </view>\r\n          <view class=\"section-meta\">\r\n            <text class=\"meta-label\">当前软件位</text>\r\n            <text class=\"meta-value\">{{ selectedSoftware || '未选择' }}</text>\r\n          </view>\r\n        </view>\r\n        <view v-if=\"!selectedSoftware\" class=\"section-empty\">请返回首页选择一个软件码后再进行设置。</view>\r\n        <view v-else>\r\n          <view v-if=\"loadingSettlement\" class=\"section-empty\">结算信息加载中...</view>\r\n          <view v-else-if=\"!editableRates.length\" class=\"section-empty\">当前软件位暂无卡密类型。</view>\r\n          <view v-else>\r\n            <view v-if=\"loadingCardTypes\" class=\"section-note\">卡密类型同步中，稍后将自动补齐列表。</view>\r\n            <view v-if=\"hasAgentOptions\" class=\"agent-selector\">\r\n              <view class=\"selector-labels\">\r\n                <text class=\"selector-title\">配置对象</text>\r\n                <text class=\"selector-hint\">为不同代理设置专属结算单价</text>\r\n              </view>\r\n              <picker\r\n                mode=\"selector\"\r\n                :range=\"agentOptions\"\r\n                range-key=\"label\"\r\n                :value=\"agentIndex\"\r\n                :disabled=\"loadingSettlement\"\r\n                @change=\"handleAgentChange\"\r\n              >\r\n                <view class=\"selector-value\" :class=\"{ disabled: loadingSettlement }\">\r\n                  <text class=\"selector-text\">{{ selectedAgentLabel }}</text>\r\n                  <text class=\"selector-arrow\">⌄</text>\r\n                </view>\r\n              </picker>\r\n            </view>\r\n            <view class=\"cycle-box\">\r\n              <view class=\"cycle-header\">\r\n                <view class=\"cycle-title-group\">\r\n                  <text class=\"cycle-title\">结算周期</text>\r\n                  <text v-if=\"cycleInherited\" class=\"cycle-badge\">继承</text>\r\n                </view>\r\n                <view class=\"cycle-status\" :class=\"{ due: cycleDue }\">\r\n                  <text class=\"status-label\">下次结算</text>\r\n                  <text class=\"status-value\">{{ nextDueText }}</text>\r\n                </view>\r\n              </view>\r\n              <view class=\"cycle-body\">\r\n                <view class=\"cycle-input\">\r\n                  <input\r\n                    class=\"cycle-field\"\r\n                    type=\"digit\"\r\n                    :placeholder=\"effectiveCycleDays > 0 ? `默认 ${effectiveCycleDays} 天` : '输入天数'\"\r\n                    v-model=\"cycleDaysInput\"\r\n                    :disabled=\"savingRates\"\r\n                    @blur=\"handleCycleBlur\"\r\n                  />\r\n                  <text class=\"cycle-unit\">天</text>\r\n                </view>\r\n                <view class=\"cycle-input\">\r\n                  <input\r\n                    class=\"cycle-field\"\r\n                    type=\"text\"\r\n                    :placeholder=\"cycleTimePlaceholder\"\r\n                    v-model=\"cycleTimeInput\"\r\n                    :disabled=\"savingRates\"\r\n                    @blur=\"handleCycleTimeBlur\"\r\n                  />\r\n                  <text class=\"cycle-unit\">时间</text>\r\n                </view>\r\n                <view class=\"cycle-meta\">\r\n                  <text class=\"meta-label\">最近结算</text>\r\n                  <text class=\"meta-value\">{{ lastSettledText }}</text>\r\n                </view>\r\n                <view class=\"cycle-meta\">\r\n                  <text class=\"meta-label\">执行时间</text>\r\n                  <text class=\"meta-value\">{{ effectiveCycleTimeText }}</text>\r\n                </view>\r\n                <view class=\"cycle-meta\" v-if=\"cycleDue\">\r\n                  <text class=\"meta-label warn\">提醒</text>\r\n                  <text class=\"meta-value warn\">当前周期已到，请及时完成结算。</text>\r\n                </view>\r\n              </view>\r\n            </view>\r\n            <view class=\"rate-table\">\r\n              <view class=\"rate-header\">\r\n                <text class=\"col-type\">卡密类型</text>\r\n                <text class=\"col-price\">结算单价（元）</text>\r\n              </view>\r\n              <view v-for=\"item in editableRates\" :key=\"item.cardType\" class=\"rate-row\">\r\n                <text class=\"col-type\">{{ item.cardType }}</text>\r\n                <input\r\n                  class=\"col-price-input\"\r\n                  type=\"digit\"\r\n                  :placeholder=\"'0.00'\"\r\n                  v-model=\"item.price\"\r\n                  @blur=\"normalizePrice(item)\"\r\n                />\r\n              </view>\r\n            </view>\r\n          </view>\r\n          <view class=\"actions\">\r\n            <button class=\"btn primary\" :disabled=\"savingRates || loadingSettlement || loadingCardTypes\" @tap=\"save\">{{ savingRates ? '保存中...' : '保存设置' }}</button>\r\n            <button class=\"btn ghost\" :disabled=\"savingRates || loadingSettlement\" @tap=\"refresh\">重新加载</button>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <view class=\"section\">\r\n        <view class=\"section-header\">\r\n          <view class=\"section-titles\">\r\n            <text class=\"section-title\">结算账单</text>\r\n            <text class=\"section-subtitle\">系统会根据结算周期生成待处理账单，确认收款后请标记已结算。</text>\r\n          </view>\r\n        </view>\r\n        <view v-if=\"!pendingBills.length && !settledBills.length\" class=\"section-empty\">暂无结算账单。</view>\r\n        <view v-else class=\"bill-list\">\r\n          <view v-for=\"bill in pendingBills\" :key=\"`pending-${bill.id}`\" class=\"bill-card pending\">\r\n            <view class=\"bill-row\">\r\n              <text class=\"bill-label\">结算周期</text>\r\n              <text class=\"bill-value\">{{ formatDateTimeDisplay(bill.cycleStartUtc) }} ~ {{ formatDateTimeDisplay(bill.cycleEndUtc) }}</text>\r\n            </view>\r\n            <view v-if=\"hasBreakdown(bill)\" class=\"bill-breakdown\">\r\n              <view class=\"breakdown-header\">\r\n                <text class=\"bill-label\">结算明细</text>\r\n                <text class=\"bill-subtotal\">建议金额：￥{{ formatCurrency(bill.suggestedAmount ?? bill.amount) }}</text>\r\n              </view>\r\n              <view v-for=\"item in bill.breakdowns\" :key=\"`${bill.id}-${item.agent}`\" class=\"breakdown-row\">\r\n                <text class=\"breakdown-agent\">{{ item.displayName || item.agent }}</text>\r\n                <text class=\"breakdown-count\">{{ item.count }} 张</text>\r\n                <text class=\"breakdown-amount\">￥{{ formatCurrency(item.amount) }}</text>\r\n              </view>\r\n            </view>\r\n            <view v-else class=\"bill-row subtle\">\r\n              <text class=\"bill-label\">结算明细</text>\r\n              <text class=\"bill-value\">当前周期无待结算数据</text>\r\n            </view>\r\n            <view class=\"bill-row\">\r\n              <text class=\"bill-label\">结算金额</text>\r\n              <input\r\n                class=\"bill-input\"\r\n                type=\"digit\"\r\n                v-model=\"billAmountEdits[bill.id]\"\r\n                :placeholder=\"bill.suggestedAmount ? formatCurrency(bill.suggestedAmount) : '0.00'\"\r\n                :disabled=\"!hasBreakdown(bill)\"\r\n              />\r\n            </view>\r\n            <view class=\"bill-row\">\r\n              <text class=\"bill-label\">备注</text>\r\n              <input\r\n                class=\"bill-input\"\r\n                type=\"text\"\r\n                v-model=\"billNoteEdits[bill.id]\"\r\n                placeholder=\"备注信息（可选）\"\r\n              />\r\n            </view>\r\n            <button class=\"btn primary\" :disabled=\"savingRates || !hasBreakdown(bill)\" @tap=\"confirmBill(bill.id)\">确认已结算</button>\r\n          </view>\r\n          <view v-for=\"bill in settledBills\" :key=\"`settled-${bill.id}`\" class=\"bill-card settled\">\r\n            <view class=\"bill-row\">\r\n              <text class=\"bill-label\">结算周期</text>\r\n              <text class=\"bill-value\">{{ formatDateTimeDisplay(bill.cycleStartUtc) }} ~ {{ formatDateTimeDisplay(bill.cycleEndUtc) }}</text>\r\n            </view>\r\n            <view class=\"bill-row\">\r\n              <text class=\"bill-label\">结算金额</text>\r\n              <text class=\"bill-value emphasis\">￥{{ formatCurrency(bill.amount) }}</text>\r\n            </view>\r\n            <view v-if=\"bill.breakdowns?.length\" class=\"bill-breakdown settled\">\r\n              <view class=\"breakdown-header\">\r\n                <text class=\"bill-label\">结算明细</text>\r\n              </view>\r\n              <view v-for=\"item in bill.breakdowns\" :key=\"`${bill.id}-${item.agent}`\" class=\"breakdown-row\">\r\n                <text class=\"breakdown-agent\">{{ item.displayName || item.agent }}</text>\r\n                <text class=\"breakdown-count\">{{ item.count }} 张</text>\r\n                <text class=\"breakdown-amount\">￥{{ formatCurrency(item.amount) }}</text>\r\n              </view>\r\n            </view>\r\n            <view class=\"bill-row\">\r\n              <text class=\"bill-label\">结算时间</text>\r\n              <text class=\"bill-value\">{{ formatDateTimeDisplay(bill.settledAtUtc) }}</text>\r\n            </view>\r\n            <view v-if=\"bill.note\" class=\"bill-row\">\r\n              <text class=\"bill-label\">备注</text>\r\n              <text class=\"bill-value\">{{ bill.note }}</text>\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <view class=\"tips\">\r\n        <text>提示：</text>\r\n        <text>1. 结算价格仅用于前端统计，不会影响卡密本身价格。</text>\r\n        <text>2. 修改后请重新在首页执行销量查询以刷新结算金额。</text>\r\n      </view>\r\n    </scroll-view>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, onMounted, reactive, ref, watch } from 'vue';\r\nimport { storeToRefs } from 'pinia';\r\nimport { useAppStore } from '@/stores/app';\r\nimport { usePlatformStore } from '@/stores/platform';\r\nimport type { CardTypeInfo, SettlementRateItem, SettlementBillItem } from '@/common/types';\r\n\r\ninterface EditableRate {\r\n  cardType: string;\r\n  price: string;\r\n}\r\n\r\nconst appStore = useAppStore();\r\nconst platformStore = usePlatformStore();\r\nconst {\r\n  selectedSoftware,\r\n  cardTypes,\r\n  selectedSettlementAgent,\r\n  settlementAgents,\r\n  activeSettlementAgent,\r\n  settlementCycle,\r\n  settlementBills,\r\n  settlementHasReminder\r\n} = storeToRefs(appStore);\r\nconst editableRates = ref<EditableRate[]>([]);\r\nconst cycleDaysInput = ref('');\r\nconst cycleTimeInput = ref('');\r\nconst billAmountEdits = reactive<Record<number, string>>({});\r\nconst billNoteEdits = reactive<Record<number, string>>({});\r\n\r\nconst loadingSettlement = computed(() => appStore.loading.settlementRates);\r\nconst loadingCardTypes = computed(() => appStore.loading.cardTypes);\r\nconst savingRates = computed(() => appStore.loading.saveSettlementRates);\r\n\r\nconst agentOptions = computed(() => {\r\n  const rawOptions = Array.isArray(settlementAgents.value) ? settlementAgents.value : [];\r\n  const options = rawOptions.map((item) => ({\r\n    value: (item?.username ?? '').toString().trim(),\r\n    label: (item?.displayName ?? '').toString().trim() || (item?.username ?? '').toString().trim()\r\n  }));\r\n\r\n  const filtered = options.filter((item) => item.value.length > 0);\r\n\r\n  if (!filtered.length) {\r\n    const fallback = activeSettlementAgent.value?.trim();\r\n    if (fallback) {\r\n      filtered.push({ value: fallback, label: `${fallback} · 当前账号` });\r\n    }\r\n  }\r\n\r\n  return filtered;\r\n});\r\n\r\nconst hasAgentOptions = computed(() => agentOptions.value.length > 0);\r\n\r\nconst selectedAgentValue = computed(() => selectedSettlementAgent.value?.trim() || activeSettlementAgent.value?.trim() || '');\r\n\r\nconst agentIndex = computed(() => {\r\n  const options = agentOptions.value;\r\n  const current = selectedAgentValue.value;\r\n  const index = options.findIndex((option) => option.value === current);\r\n  return index >= 0 ? index : 0;\r\n});\r\n\r\nconst selectedAgentLabel = computed(() => {\r\n  const options = agentOptions.value;\r\n  const current = selectedAgentValue.value;\r\n  const match = options.find((option) => option.value === current);\r\n  return match?.label || options[0]?.label || '当前账号';\r\n});\r\n\r\nconst cycleInfo = computed(() => settlementCycle.value);\r\nconst cycleDue = computed(() => Boolean(cycleInfo.value?.isDue));\r\nconst effectiveCycleDays = computed(() => cycleInfo.value?.effectiveDays ?? 0);\r\nconst cycleInherited = computed(() => Boolean(cycleInfo.value?.isInherited));\r\nconst nextDueText = computed(() => formatDateTimeDisplay(cycleInfo.value?.nextDueTimeUtc));\r\nconst lastSettledText = computed(() => formatDateTimeDisplay(cycleInfo.value?.lastSettledTimeUtc));\r\nconst effectiveCycleTimeText = computed(\r\n  () => cycleInfo.value?.effectiveTimeLabel || formatTimeLabel(0)\r\n);\r\nconst cycleTimePlaceholder = computed(() => {\r\n  const info = cycleInfo.value;\r\n  if (!info) {\r\n    return 'HH:mm';\r\n  }\r\n  const ownDefined = Number.isInteger(info.ownTimeMinutes) &&\r\n    (info.ownDays > 0 || info.ownTimeMinutes !== info.effectiveTimeMinutes);\r\n  if (ownDefined) {\r\n    return info.ownTimeLabel || formatTimeLabel(info.ownTimeMinutes);\r\n  }\r\n  return `默认 ${info.effectiveTimeLabel || formatTimeLabel(info.effectiveTimeMinutes)}`;\r\n});\r\n\r\nconst pendingBills = computed(() => settlementBills.value.filter((bill) => !bill.isSettled));\r\nconst settledBills = computed(() => settlementBills.value.filter((bill) => bill.isSettled));\r\n\r\nfunction hasBreakdown(bill: SettlementBillItem) {\r\n  return Array.isArray(bill?.breakdowns) && bill.breakdowns.length > 0;\r\n}\r\n\r\nwatch(\r\n  agentOptions,\r\n  async (options) => {\r\n    if (!options.length) {\r\n      return;\r\n    }\r\n    const current = selectedAgentValue.value;\r\n    const hasMatch = options.some((option) => option.value === current);\r\n    if (!hasMatch) {\r\n      const fallback = options[0];\r\n      if (fallback) {\r\n        appStore.setSelectedSettlementAgent(fallback.value);\r\n        await refresh(true);\r\n      }\r\n    }\r\n  },\r\n  { immediate: false }\r\n);\r\n\r\nwatch(\r\n  settlementCycle,\r\n  (cycle) => {\r\n    if (!cycle) {\r\n      cycleDaysInput.value = '';\r\n      cycleTimeInput.value = '';\r\n      return;\r\n    }\r\n    const source = cycle.ownDays > 0 ? cycle.ownDays : cycle.effectiveDays;\r\n    cycleDaysInput.value = source > 0 ? String(source) : '';\r\n    const timeSource =\r\n      cycle.ownDays > 0 || cycle.ownTimeMinutes !== cycle.effectiveTimeMinutes\r\n        ? cycle.ownTimeMinutes\r\n        : cycle.effectiveTimeMinutes;\r\n    if (Number.isFinite(timeSource)) {\r\n      cycleTimeInput.value = formatTimeLabel(Number(timeSource));\r\n    } else {\r\n      cycleTimeInput.value = '';\r\n    }\r\n  },\r\n  { immediate: true }\r\n);\r\n\r\nwatch(\r\n  pendingBills,\r\n  (bills) => {\r\n    const activeIds = new Set<number>();\r\n    bills.forEach((bill) => {\r\n      activeIds.add(bill.id);\r\n      const suggested = formatAmountInput(bill.suggestedAmount ?? bill.amount);\r\n      if (!billAmountEdits[bill.id] || billAmountEdits[bill.id] === '0' || billAmountEdits[bill.id] === '0.00') {\r\n        billAmountEdits[bill.id] = suggested;\r\n      }\r\n      if (bill.note && !billNoteEdits[bill.id]) {\r\n        billNoteEdits[bill.id] = bill.note;\r\n      }\r\n    });\r\n\r\n    Object.keys(billAmountEdits).forEach((key) => {\r\n      const id = Number(key);\r\n      if (!Number.isFinite(id) || !activeIds.has(id)) {\r\n        delete billAmountEdits[id];\r\n      }\r\n    });\r\n\r\n    Object.keys(billNoteEdits).forEach((key) => {\r\n      const id = Number(key);\r\n      if (!Number.isFinite(id) || !activeIds.has(id)) {\r\n        delete billNoteEdits[id];\r\n      }\r\n    });\r\n  },\r\n  { immediate: true }\r\n);\r\n\r\nasync function bootstrap() {\r\n  if (!platformStore.isAuthenticated) {\r\n    return;\r\n  }\r\n  await refresh(true);\r\n}\r\n\r\nlet refreshGeneration = 0;\r\n\r\nfunction buildEditableRates(\r\n  settlementRatesList: SettlementRateItem[],\r\n  cardTypeList?: CardTypeInfo[] | null\r\n): EditableRate[] {\r\n  const availableTypes = new Set<string>();\r\n  settlementRatesList.forEach((rate) => {\r\n    if (rate?.cardType) {\r\n      availableTypes.add(rate.cardType);\r\n    }\r\n  });\r\n\r\n  if (Array.isArray(cardTypeList)) {\r\n    cardTypeList.forEach((type) => {\r\n      if (type?.name) {\r\n        availableTypes.add(type.name);\r\n      }\r\n    });\r\n  }\r\n\r\n  return Array.from(availableTypes)\r\n    .sort((a, b) => a.localeCompare(b))\r\n    .map((cardType) => {\r\n      const current = settlementRatesList.find((rate) => rate.cardType === cardType);\r\n      return {\r\n        cardType,\r\n        price: current ? formatCurrency(current.price) : '0.00'\r\n      };\r\n    });\r\n}\r\n\r\nasync function refresh(force = false) {\r\n  const software = selectedSoftware.value;\r\n  if (!software) {\r\n    editableRates.value = [];\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const generation = ++refreshGeneration;\r\n    const cardTypesPromise = appStore\r\n      .loadCardTypes(force)\r\n      .catch((error) => {\r\n        uni.__f__('warn','at pages/agent/settlement.vue:429','loadCardTypes failed', error);\r\n        return null;\r\n      });\r\n\r\n    const loadedSettlementRates = await appStore.loadSettlementRates(force);\r\n    const settlementRates = Array.isArray(loadedSettlementRates) ? loadedSettlementRates : [];\r\n\r\n    editableRates.value = buildEditableRates(settlementRates, cardTypes.value);\r\n\r\n    cardTypesPromise.then((loadedCardTypes) => {\r\n      if (generation !== refreshGeneration) {\r\n        return;\r\n      }\r\n      const resolved = Array.isArray(loadedCardTypes) && loadedCardTypes.length > 0\r\n        ? loadedCardTypes\r\n        : cardTypes.value;\r\n      editableRates.value = buildEditableRates(settlementRates, resolved);\r\n    });\r\n  } catch (error) {\r\n    uni.__f__('error','at pages/agent/settlement.vue:448','refresh settlement rates failed', error);\r\n    uni.showToast({ title: '加载失败', icon: 'none' });\r\n  }\r\n}\r\n\r\nfunction formatCurrency(value: number | string) {\r\n  const amount = Number(value ?? 0);\r\n  if (!Number.isFinite(amount)) {\r\n    return '0.00';\r\n  }\r\n  return amount.toFixed(2);\r\n}\r\n\r\nfunction formatAmountInput(value?: number | null) {\r\n  if (value == null) {\r\n    return '';\r\n  }\r\n  const numeric = Number(value);\r\n  if (!Number.isFinite(numeric) || numeric <= 0) {\r\n    return '';\r\n  }\r\n  return formatCurrency(numeric);\r\n}\r\n\r\nfunction normalizePrice(item: EditableRate) {\r\n  item.price = formatCurrency(item.price);\r\n}\r\n\r\nfunction formatDateTimeDisplay(value?: string | null) {\r\n  if (!value) {\r\n    return '--';\r\n  }\r\n  const date = new Date(value);\r\n  if (Number.isNaN(date.getTime())) {\r\n    return value;\r\n  }\r\n  const yyyy = date.getFullYear();\r\n  const mm = String(date.getMonth() + 1).padStart(2, '0');\r\n  const dd = String(date.getDate()).padStart(2, '0');\r\n  const hh = String(date.getHours()).padStart(2, '0');\r\n  const mi = String(date.getMinutes()).padStart(2, '0');\r\n  return `${yyyy}-${mm}-${dd} ${hh}:${mi}`;\r\n}\r\n\r\nfunction formatTimeLabel(value?: number | string | null) {\r\n  const minutes = Number(value);\r\n  if (!Number.isFinite(minutes)) {\r\n    return '00:00';\r\n  }\r\n  const normalized = ((minutes % 1440) + 1440) % 1440;\r\n  const hours = Math.floor(normalized / 60);\r\n  const mins = Math.floor(normalized % 60);\r\n  return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;\r\n}\r\n\r\nfunction parseCycleDays(): number | null {\r\n  const raw = cycleDaysInput.value.trim();\r\n  if (!raw) {\r\n    return null;\r\n  }\r\n  const numeric = Number(raw);\r\n  if (!Number.isFinite(numeric) || numeric <= 0) {\r\n    return 0;\r\n  }\r\n  return Math.floor(numeric);\r\n}\r\n\r\nfunction handleCycleBlur() {\r\n  const parsed = parseCycleDays();\r\n  if (parsed === null || parsed <= 0) {\r\n    cycleDaysInput.value = '';\r\n  } else {\r\n    cycleDaysInput.value = String(parsed);\r\n  }\r\n}\r\n\r\nfunction parseCycleTimeMinutes(): number | null | undefined {\r\n  const raw = cycleTimeInput.value.trim();\r\n  if (!raw) {\r\n    return null;\r\n  }\r\n  const normalized = raw.replace('：', ':');\r\n  const match = normalized.match(/^\\s*(\\d{1,2})\\s*:\\s*(\\d{1,2})\\s*$/);\r\n  if (!match) {\r\n    return undefined;\r\n  }\r\n  const hours = Number(match[1]);\r\n  const minutes = Number(match[2]);\r\n  if (!Number.isFinite(hours) || !Number.isFinite(minutes) || hours < 0 || hours > 23 || minutes < 0 || minutes > 59) {\r\n    return undefined;\r\n  }\r\n  return hours * 60 + minutes;\r\n}\r\n\r\nfunction handleCycleTimeBlur() {\r\n  const parsed = parseCycleTimeMinutes();\r\n  if (parsed === undefined) {\r\n    cycleTimeInput.value = '';\r\n    uni.showToast({ title: '时间格式应为 HH:mm', icon: 'none' });\r\n    return;\r\n  }\r\n  if (parsed === null) {\r\n    cycleTimeInput.value = '';\r\n    return;\r\n  }\r\n  cycleTimeInput.value = formatTimeLabel(parsed);\r\n}\r\n\r\nasync function save() {\r\n  const software = selectedSoftware.value;\r\n  if (!software) {\r\n    uni.showToast({ title: '请先选择软件位', icon: 'none' });\r\n    return;\r\n  }\r\n\r\n  const payload = editableRates.value.map((item) => ({\r\n    cardType: item.cardType,\r\n    price: Number(item.price) || 0\r\n  }));\r\n\r\n  try {\r\n    const cycleDays = parseCycleDays();\r\n    const cycleTimeMinutes = parseCycleTimeMinutes();\r\n    if (cycleTimeMinutes === undefined) {\r\n      uni.showToast({ title: '请填写正确的结算时间（HH:mm）', icon: 'none' });\r\n      return;\r\n    }\r\n    await appStore.saveSettlementRates(\r\n      payload,\r\n      cycleDays ?? undefined,\r\n      cycleTimeMinutes ?? undefined\r\n    );\r\n    uni.showToast({ title: '保存成功', icon: 'success' });\r\n    await refresh(true);\r\n  } catch (error) {\r\n    uni.__f__('error','at pages/agent/settlement.vue:583','save settlement rates failed', error);\r\n    const message = (error as any)?.message || '保存失败';\r\n    uni.showToast({ title: message, icon: 'none' });\r\n  }\r\n}\r\n\r\nasync function confirmBill(billId: number) {\r\n  const rawAmount = billAmountEdits[billId] ?? '0';\r\n  let amount = Number(rawAmount);\r\n  const bill = pendingBills.value.find((item) => item.id === billId);\r\n  if ((!Number.isFinite(amount) || amount <= 0) && bill && Number(bill.suggestedAmount ?? 0) > 0) {\r\n    amount = Number(bill.suggestedAmount);\r\n  }\r\n\r\n  if (!Number.isFinite(amount) || amount < 0) {\r\n    uni.showToast({ title: '请输入有效金额', icon: 'none' });\r\n    return;\r\n  }\r\n\r\n  try {\r\n    await appStore.completeSettlementBill(billId, amount, billNoteEdits[billId]);\r\n    delete billAmountEdits[billId];\r\n    delete billNoteEdits[billId];\r\n    uni.showToast({ title: '账单已结算', icon: 'success' });\r\n  } catch (error) {\r\n    uni.__f__('error','at pages/agent/settlement.vue:608','complete settlement bill failed', error);\r\n    const message = (error as any)?.message || '更新失败';\r\n    uni.showToast({ title: message, icon: 'none' });\r\n  }\r\n}\r\n\r\nasync function handleAgentChange(event: any) {\r\n  const index = Number(event?.detail?.value ?? 0);\r\n  const options = agentOptions.value;\r\n  const option = options[index];\r\n  if (!option) {\r\n    return;\r\n  }\r\n  appStore.setSelectedSettlementAgent(option.value);\r\n  await refresh(true);\r\n}\r\n\r\nfunction goLogin() {\r\n  uni.reLaunch({ url: '/pages/login/agent' });\r\n}\r\n\r\nwatch(\r\n  () => selectedSoftware.value,\r\n  () => {\r\n    refresh();\r\n  }\r\n);\r\n\r\nonMounted(() => {\r\n  bootstrap();\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.page {\r\n  min-height: 100vh;\r\n  background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.12), transparent 55%), #0f172a;\r\n  padding: 24rpx 24rpx 48rpx;\r\n  color: rgba(226, 232, 240, 0.9);\r\n}\r\n\r\n.content {\r\n  height: 100%;\r\n}\r\n\r\n.section {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 24rpx;\r\n  padding: 32rpx 28rpx;\r\n  border-radius: 24rpx;\r\n  background: rgba(15, 23, 42, 0.6);\r\n  border: 1px solid rgba(148, 163, 184, 0.2);\r\n}\r\n\r\n.section-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: flex-start;\r\n  gap: 24rpx;\r\n}\r\n\r\n.agent-selector {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  gap: 24rpx;\r\n  margin-bottom: 24rpx;\r\n  padding: 20rpx 24rpx;\r\n  border-radius: 20rpx;\r\n  background: rgba(15, 23, 42, 0.45);\r\n  border: 1px solid rgba(148, 163, 184, 0.16);\r\n}\r\n\r\n.selector-labels {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 6rpx;\r\n}\r\n\r\n.selector-title {\r\n  font-size: 28rpx;\r\n  font-weight: 600;\r\n  color: rgba(226, 232, 240, 0.92);\r\n}\r\n\r\n.selector-hint {\r\n  font-size: 24rpx;\r\n  color: rgba(148, 163, 184, 0.85);\r\n}\r\n\r\n.selector-value {\r\n  min-width: 260rpx;\r\n  padding: 18rpx 24rpx;\r\n  border-radius: 16rpx;\r\n  border: 1px solid rgba(94, 234, 212, 0.35);\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 16rpx;\r\n  color: rgba(226, 232, 240, 0.95);\r\n  background: rgba(15, 23, 42, 0.65);\r\n}\r\n\r\n.cycle-box {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 16rpx;\r\n  padding: 24rpx;\r\n  border-radius: 20rpx;\r\n  border: 1px solid rgba(94, 234, 212, 0.25);\r\n  background: rgba(15, 23, 42, 0.5);\r\n  margin-bottom: 24rpx;\r\n}\r\n\r\n.cycle-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.cycle-title-group {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12rpx;\r\n}\r\n\r\n.cycle-title {\r\n  font-size: 30rpx;\r\n  font-weight: 600;\r\n  color: rgba(226, 232, 240, 0.95);\r\n}\r\n\r\n.cycle-badge {\r\n  font-size: 22rpx;\r\n  padding: 4rpx 12rpx;\r\n  border-radius: 999rpx;\r\n  background: rgba(59, 130, 246, 0.25);\r\n  color: rgba(191, 219, 254, 0.95);\r\n}\r\n\r\n.cycle-status {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12rpx;\r\n  font-size: 26rpx;\r\n  color: rgba(148, 163, 184, 0.9);\r\n}\r\n\r\n.cycle-status.due .status-value {\r\n  color: #fbbf24;\r\n}\r\n\r\n.status-label {\r\n  font-size: 24rpx;\r\n  color: rgba(148, 163, 184, 0.85);\r\n}\r\n\r\n.status-value {\r\n  font-size: 28rpx;\r\n  font-weight: 600;\r\n  color: rgba(226, 232, 240, 0.95);\r\n}\r\n\r\n.cycle-body {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 18rpx;\r\n}\r\n\r\n.cycle-input {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 16rpx;\r\n}\r\n\r\n.cycle-input + .cycle-input {\r\n  margin-top: 12rpx;\r\n}\r\n\r\n.cycle-field {\r\n  flex: 1;\r\n  padding: 18rpx 20rpx;\r\n  border-radius: 14rpx;\r\n  background: rgba(15, 23, 42, 0.6);\r\n  border: 1px solid rgba(94, 234, 212, 0.35);\r\n  color: rgba(226, 232, 240, 0.95);\r\n}\r\n\r\n.cycle-unit {\r\n  font-size: 26rpx;\r\n  color: rgba(148, 163, 184, 0.85);\r\n}\r\n\r\n.cycle-meta {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  font-size: 24rpx;\r\n  color: rgba(148, 163, 184, 0.85);\r\n}\r\n\r\n.cycle-meta .meta-value {\r\n  color: rgba(226, 232, 240, 0.9);\r\n}\r\n\r\n.cycle-meta.warn .meta-label,\r\n.cycle-meta.warn .meta-value {\r\n  color: #fbbf24;\r\n}\r\n\r\n.bill-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 20rpx;\r\n}\r\n\r\n.bill-card {\r\n  border-radius: 20rpx;\r\n  border: 1px solid rgba(148, 163, 184, 0.18);\r\n  background: rgba(15, 23, 42, 0.55);\r\n  padding: 24rpx 26rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 18rpx;\r\n}\r\n\r\n.bill-card.pending {\r\n  border-color: rgba(250, 204, 21, 0.45);\r\n  box-shadow: 0 0 24rpx rgba(250, 204, 21, 0.12);\r\n}\r\n\r\n.bill-card.settled {\r\n  border-color: rgba(94, 234, 212, 0.35);\r\n}\r\n\r\n.bill-row {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  gap: 18rpx;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.bill-label {\r\n  color: rgba(148, 163, 184, 0.8);\r\n}\r\n\r\n.bill-value {\r\n  color: rgba(226, 232, 240, 0.95);\r\n  text-align: right;\r\n  flex: 1;\r\n}\r\n\r\n.bill-value.emphasis {\r\n  font-weight: 600;\r\n  color: rgba(94, 234, 212, 0.9);\r\n}\r\n\r\n.bill-input {\r\n  flex: 1;\r\n  padding: 16rpx 18rpx;\r\n  border-radius: 14rpx;\r\n  border: 1px solid rgba(94, 234, 212, 0.3);\r\n  background: rgba(15, 23, 42, 0.55);\r\n  color: rgba(226, 232, 240, 0.95);\r\n}\r\n\r\n.bill-row.subtle .bill-value {\r\n  color: rgba(148, 163, 184, 0.75);\r\n}\r\n\r\n.bill-breakdown {\r\n  border: 1px solid rgba(148, 163, 184, 0.16);\r\n  border-radius: 16rpx;\r\n  padding: 16rpx 20rpx;\r\n  background: rgba(15, 23, 42, 0.45);\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12rpx;\r\n}\r\n\r\n.bill-breakdown.settled {\r\n  border-color: rgba(94, 234, 212, 0.25);\r\n  background: rgba(15, 23, 42, 0.35);\r\n}\r\n\r\n.breakdown-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.bill-subtotal {\r\n  color: rgba(94, 234, 212, 0.85);\r\n  font-weight: 600;\r\n}\r\n\r\n.breakdown-row {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  gap: 12rpx;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.breakdown-agent {\r\n  flex: 1;\r\n  color: rgba(226, 232, 240, 0.92);\r\n}\r\n\r\n.breakdown-count {\r\n  color: rgba(148, 163, 184, 0.8);\r\n  min-width: 120rpx;\r\n  text-align: right;\r\n}\r\n\r\n.breakdown-amount {\r\n  min-width: 160rpx;\r\n  text-align: right;\r\n  color: rgba(94, 234, 212, 0.9);\r\n  font-weight: 600;\r\n}\r\n\r\n.selector-value.disabled {\r\n  opacity: 0.6;\r\n}\r\n\r\n.selector-text {\r\n  flex: 1;\r\n  font-size: 26rpx;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n.selector-arrow {\r\n  font-size: 32rpx;\r\n  color: rgba(148, 163, 184, 0.8);\r\n}\r\n\r\n.section-titles {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8rpx;\r\n}\r\n\r\n.section-title {\r\n  font-size: 34rpx;\r\n  font-weight: 600;\r\n}\r\n\r\n.section-subtitle {\r\n  font-size: 24rpx;\r\n  color: rgba(148, 163, 184, 0.85);\r\n}\r\n\r\n.section-meta {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-end;\r\n  gap: 6rpx;\r\n  font-size: 24rpx;\r\n  color: rgba(148, 163, 184, 0.85);\r\n}\r\n\r\n.meta-label {\r\n  font-size: 22rpx;\r\n}\r\n\r\n.meta-value {\r\n  font-size: 28rpx;\r\n  font-weight: 600;\r\n  color: rgba(191, 219, 254, 0.95);\r\n}\r\n\r\n.section-empty {\r\n  padding: 48rpx 20rpx;\r\n  text-align: center;\r\n  color: rgba(148, 163, 184, 0.8);\r\n}\r\n\r\n.section-note {\r\n  margin-bottom: 16rpx;\r\n  padding: 16rpx 20rpx;\r\n  border-radius: 14rpx;\r\n  background: rgba(59, 130, 246, 0.12);\r\n  color: rgba(191, 219, 254, 0.9);\r\n  font-size: 24rpx;\r\n}\r\n\r\n.rate-table {\r\n  border: 1rpx solid rgba(148, 163, 184, 0.2);\r\n  border-radius: 18rpx;\r\n  overflow: hidden;\r\n}\r\n\r\n.rate-header,\r\n.rate-row {\r\n  display: grid;\r\n  grid-template-columns: 2fr 1fr;\r\n  align-items: center;\r\n  padding: 18rpx 24rpx;\r\n  gap: 16rpx;\r\n}\r\n\r\n.rate-header {\r\n  background: rgba(59, 130, 246, 0.15);\r\n  font-size: 24rpx;\r\n  color: rgba(226, 232, 240, 0.9);\r\n}\r\n\r\n.rate-row {\r\n  background: rgba(15, 23, 42, 0.45);\r\n  font-size: 24rpx;\r\n}\r\n\r\n.rate-row + .rate-row {\r\n  border-top: 1rpx solid rgba(148, 163, 184, 0.12);\r\n}\r\n\r\n.col-type {\r\n  font-weight: 600;\r\n}\r\n\r\n.col-price {\r\n  text-align: right;\r\n}\r\n\r\n.col-price-input {\r\n  width: 100%;\r\n  padding: 16rpx 20rpx;\r\n  border-radius: 14rpx;\r\n  background: rgba(15, 23, 42, 0.75);\r\n  border: 1rpx solid rgba(148, 163, 184, 0.35);\r\n  color: rgba(226, 232, 240, 0.9);\r\n  font-size: 24rpx;\r\n  text-align: right;\r\n}\r\n\r\n.actions {\r\n  margin-top: 28rpx;\r\n  display: flex;\r\n  gap: 20rpx;\r\n}\r\n\r\n.btn {\r\n  flex: 1;\r\n  padding: 18rpx 24rpx;\r\n  border-radius: 16rpx;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.btn.primary {\r\n  background: linear-gradient(135deg, rgba(59, 130, 246, 0.85), rgba(129, 140, 248, 0.85));\r\n  color: #f8fafc;\r\n  border: none;\r\n}\r\n\r\n.btn.ghost {\r\n  background: transparent;\r\n  color: rgba(191, 219, 254, 0.95);\r\n  border: 1rpx solid rgba(148, 163, 184, 0.3);\r\n}\r\n\r\n.tips {\r\n  margin-top: 28rpx;\r\n  padding: 24rpx 28rpx;\r\n  border-radius: 18rpx;\r\n  background: rgba(30, 41, 59, 0.65);\r\n  border: 1rpx solid rgba(148, 163, 184, 0.18);\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12rpx;\r\n  font-size: 24rpx;\r\n  color: rgba(148, 163, 184, 0.85);\r\n}\r\n\r\n.empty {\r\n  min-height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 20rpx;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: rgba(226, 232, 240, 0.85);\r\n}\r\n\r\n.link {\r\n  padding: 14rpx 28rpx;\r\n  border-radius: 14rpx;\r\n  border: 1rpx solid rgba(148, 163, 184, 0.35);\r\n  background: transparent;\r\n  color: rgba(191, 219, 254, 0.95);\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Administrator/source/repos/wwwskbjxyz/SPTEST-V1/SProtectAgentWeb.Api/wwwroot/uniapp/pages/agent/settlement.vue'\nwx.createPage(MiniProgramPage)"],"names":["useAppStore","usePlatformStore","storeToRefs","ref","reactive","computed","watch","uni","onMounted"],"mappings":"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"}
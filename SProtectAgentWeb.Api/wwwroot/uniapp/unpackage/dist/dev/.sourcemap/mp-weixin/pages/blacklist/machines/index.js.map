{"version":3,"file":"index.js","sources":["pages/blacklist/machines/index.vue","E:/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYmxhY2tsaXN0L21hY2hpbmVzL2luZGV4LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <view class=\"header glass-card\">\r\n      <view>\r\n        <text class=\"title\">黑名单机器码</text>\r\n        <text class=\"subtitle\">维护需要封禁的机器码或 IP 列表</text>\r\n      </view>\r\n      <view class=\"form\">\r\n        <input class=\"input\" placeholder=\"输入机器码或唯一值\" v-model=\"form.value\" />\r\n        <picker mode=\"selector\" :range=\"typeOptions.map((item) => item.label)\" :value=\"form.typeIndex\" @change=\"onTypeChange\">\r\n          <view class=\"picker-display\">{{ typeOptions[form.typeIndex].label }}</view>\r\n        </picker>\r\n        <input class=\"input\" placeholder=\"备注（可选）\" v-model=\"form.remark\" />\r\n        <button class=\"btn primary\" :disabled=\"!form.value.trim() || submitting\" @tap=\"create\">{{ submitting ? '提交中...' : '加入黑名单' }}</button>\r\n        <button class=\"btn ghost\" :disabled=\"loading\" @tap=\"refresh\">刷新列表</button>\r\n      </view>\r\n    </view>\r\n\r\n    <view class=\"list glass-card\">\r\n      <view v-if=\"loading\" class=\"empty\">数据加载中...</view>\r\n      <view v-else-if=\"!machines.length\" class=\"empty\">当前软件暂无黑名单记录</view>\r\n      <view v-else class=\"items\">\r\n        <view v-for=\"item in machines\" :key=\"item.value\" class=\"item glass-light\">\r\n          <view class=\"row\">\r\n            <text class=\"label\">值</text>\r\n            <text class=\"value highlight\">{{ item.value }}</text>\r\n          </view>\r\n          <view class=\"row\">\r\n            <text class=\"label\">类型</text>\r\n            <text class=\"value\">{{ formatType(item.type) }}</text>\r\n          </view>\r\n          <view class=\"row\">\r\n            <text class=\"label\">备注</text>\r\n            <text class=\"value\">{{ item.remarks || '-' }}</text>\r\n          </view>\r\n          <button class=\"btn danger\" @tap=\"remove(item.value)\">删除</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, reactive, ref, watch, onMounted } from 'vue';\r\nimport { storeToRefs } from 'pinia';\r\nimport { useAppStore } from '@/stores/app';\r\n\r\nconst appStore = useAppStore();\r\nconst { blacklistMachines, selectedSoftware } = storeToRefs(appStore);\r\n\r\nconst loading = computed(() => appStore.loading.blacklistMachines);\r\nconst machines = computed(() => blacklistMachines.value);\r\nconst submitting = ref(false);\r\n\r\nconst typeOptions = [\r\n  { label: '机器码 (2)', value: 2 },\r\n  { label: 'IP (1)', value: 1 },\r\n  { label: '其他 (0)', value: 0 }\r\n];\r\n\r\nconst form = reactive({\r\n  value: '',\r\n  typeIndex: 0,\r\n  remark: ''\r\n});\r\n\r\nfunction onTypeChange(event: UniApp.PickerChangeEvent) {\r\n  form.typeIndex = Number(event.detail.value) || 0;\r\n}\r\n\r\nasync function load() {\r\n  await appStore.loadBlacklistMachines();\r\n}\r\n\r\nasync function refresh() {\r\n  await load();\r\n}\r\n\r\nfunction formatType(type: number) {\r\n  const match = typeOptions.find((item) => item.value === type);\r\n  if (match) return match.label.replace(/ \\(\\d+\\)/, '');\r\n  return '其他';\r\n}\r\n\r\nasync function create() {\r\n  if (!form.value.trim()) {\r\n    uni.showToast({ title: '请输入机器码', icon: 'none' });\r\n    return;\r\n  }\r\n  submitting.value = true;\r\n  try {\r\n    await appStore.createBlacklistMachine({\r\n      value: form.value.trim(),\r\n      type: typeOptions[form.typeIndex]?.value ?? 2,\r\n      remarks: form.remark.trim() || undefined\r\n    });\r\n    form.value = '';\r\n    form.remark = '';\r\n    uni.showToast({ title: '已加入黑名单', icon: 'success' });\r\n  } catch (error) {\r\n    uni.__f__('error','at pages/blacklist/machines/index.vue:101','create blacklist machine error', error);\r\n    uni.showToast({ title: '操作失败', icon: 'none' });\r\n  } finally {\r\n    submitting.value = false;\r\n  }\r\n}\r\n\r\nasync function remove(value: string) {\r\n  if (!value) return;\r\n  try {\r\n    await appStore.deleteBlacklistMachines([value]);\r\n    uni.showToast({ title: '已删除', icon: 'success' });\r\n  } catch (error) {\r\n    uni.__f__('error','at pages/blacklist/machines/index.vue:114','delete blacklist machine error', error);\r\n    uni.showToast({ title: '删除失败', icon: 'none' });\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  await appStore.ensureReady();\r\n  await load();\r\n});\r\n\r\nwatch(\r\n  () => selectedSoftware.value,\r\n  async (next, prev) => {\r\n    if (!next || next === prev) return;\r\n    await load();\r\n  }\r\n);\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.page {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 32rpx;\r\n  padding: 36rpx 28rpx 72rpx;\r\n}\r\n\r\n.header {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 24rpx;\r\n  padding: 32rpx;\r\n}\r\n\r\n.title {\r\n  font-size: 42rpx;\r\n  font-weight: 600;\r\n  color: var(--text-primary);\r\n}\r\n\r\n.subtitle {\r\n  font-size: 26rpx;\r\n  color: var(--text-muted);\r\n  margin-top: 6rpx;\r\n}\r\n\r\n.form {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(220rpx, 1fr));\r\n  gap: 16rpx;\r\n  align-items: center;\r\n}\r\n\r\n.input {\r\n  padding: 16rpx 24rpx;\r\n  border-radius: 20rpx;\r\n  background: var(--surface-light);\r\n  border: 1rpx solid var(--outline-color);\r\n  color: var(--text-primary);\r\n  font-size: 26rpx;\r\n}\r\n\r\n.picker-display {\r\n  padding: 16rpx 24rpx;\r\n  border-radius: 20rpx;\r\n  background: var(--surface-light);\r\n  border: 1rpx solid var(--outline-color);\r\n  color: var(--text-primary);\r\n  font-size: 26rpx;\r\n}\r\n\r\n.btn {\r\n  padding: 16rpx 30rpx;\r\n  border-radius: 999rpx;\r\n  border: 1rpx solid var(--outline-color);\r\n  background: transparent;\r\n  color: var(--text-muted);\r\n  font-size: 26rpx;\r\n  font-weight: 600;\r\n}\r\n\r\n.btn.primary {\r\n  background: var(--accent-gradient);\r\n  color: #04101c;\r\n  border: none;\r\n}\r\n\r\n.btn.ghost {\r\n  border-color: var(--outline-color);\r\n}\r\n\r\n.btn:disabled {\r\n  opacity: 0.6;\r\n}\r\n\r\n.list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 18rpx;\r\n}\r\n\r\n.empty {\r\n  padding: 28rpx 24rpx;\r\n  text-align: center;\r\n  color: var(--text-muted);\r\n  font-size: 24rpx;\r\n}\r\n\r\n.items {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 18rpx;\r\n}\r\n\r\n.item {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 14rpx;\r\n  padding: 18rpx 22rpx;\r\n}\r\n\r\n.row {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  gap: 16rpx;\r\n}\r\n\r\n.label {\r\n  font-size: 24rpx;\r\n  color: var(--text-muted);\r\n}\r\n\r\n.value {\r\n  font-size: 24rpx;\r\n  color: var(--text-primary);\r\n  word-break: break-all;\r\n  text-align: right;\r\n}\r\n\r\n.value.highlight {\r\n  font-weight: 600;\r\n}\r\n</style>","import MiniProgramPage from 'C:/Users/Administrator/source/repos/wwwskbjxyz/SPTEST-V1/SProtectAgentWeb.Api/wwwroot/uniapp/pages/blacklist/machines/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["useAppStore","storeToRefs","computed","ref","reactive","uni","onMounted","watch"],"mappings":";;;;;;AA+CA,UAAM,WAAWA,WAAAA;AACjB,UAAM,EAAE,mBAAmB,iBAAiB,IAAIC,0BAAY,QAAQ;AAEpE,UAAM,UAAUC,cAAAA,SAAS,MAAM,SAAS,QAAQ,iBAAiB;AACjE,UAAM,WAAWA,cAAA,SAAS,MAAM,kBAAkB,KAAK;AACjD,UAAA,aAAaC,kBAAI,KAAK;AAE5B,UAAM,cAAc;AAAA,MAClB,EAAE,OAAO,WAAW,OAAO,EAAE;AAAA,MAC7B,EAAE,OAAO,UAAU,OAAO,EAAE;AAAA,MAC5B,EAAE,OAAO,UAAU,OAAO,EAAE;AAAA,IAAA;AAG9B,UAAM,OAAOC,cAAAA,SAAS;AAAA,MACpB,OAAO;AAAA,MACP,WAAW;AAAA,MACX,QAAQ;AAAA,IAAA,CACT;AAED,aAAS,aAAa,OAAiC;AACrD,WAAK,YAAY,OAAO,MAAM,OAAO,KAAK,KAAK;AAAA,IACjD;AAEA,mBAAe,OAAO;AACpB,YAAM,SAAS;IACjB;AAEA,mBAAe,UAAU;AACvB,YAAM,KAAK;AAAA,IACb;AAEA,aAAS,WAAW,MAAc;AAChC,YAAM,QAAQ,YAAY,KAAK,CAAC,SAAS,KAAK,UAAU,IAAI;AACxD,UAAA;AAAO,eAAO,MAAM,MAAM,QAAQ,YAAY,EAAE;AAC7C,aAAA;AAAA,IACT;AAEA,mBAAe,SAAS;;AACtB,UAAI,CAAC,KAAK,MAAM,QAAQ;AACtBC,sBAAA,MAAI,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAC/C;AAAA,MACF;AACA,iBAAW,QAAQ;AACf,UAAA;AACF,cAAM,SAAS,uBAAuB;AAAA,UACpC,OAAO,KAAK,MAAM,KAAK;AAAA,UACvB,QAAM,iBAAY,KAAK,SAAS,MAA1B,mBAA6B,UAAS;AAAA,UAC5C,SAAS,KAAK,OAAO,KAAA,KAAU;AAAA,QAAA,CAChC;AACD,aAAK,QAAQ;AACb,aAAK,SAAS;AACdA,sBAAA,MAAI,UAAU,EAAE,OAAO,UAAU,MAAM,WAAW;AAAA,eAC3C,OAAO;AACdA,sBAAA,MAAI,MAAM,SAAQ,6CAA4C,kCAAkC,KAAK;AACrGA,sBAAA,MAAI,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,MAAA,UAC7C;AACA,mBAAW,QAAQ;AAAA,MACrB;AAAA,IACF;AAEA,mBAAe,OAAO,OAAe;AACnC,UAAI,CAAC;AAAO;AACR,UAAA;AACF,cAAM,SAAS,wBAAwB,CAAC,KAAK,CAAC;AAC9CA,sBAAA,MAAI,UAAU,EAAE,OAAO,OAAO,MAAM,WAAW;AAAA,eACxC,OAAO;AACdA,sBAAA,MAAI,MAAM,SAAQ,6CAA4C,kCAAkC,KAAK;AACrGA,sBAAA,MAAI,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,MAC/C;AAAA,IACF;AAEAC,kBAAAA,UAAU,YAAY;AACpB,YAAM,SAAS;AACf,YAAM,KAAK;AAAA,IAAA,CACZ;AAEDC,kBAAA;AAAA,MACE,MAAM,iBAAiB;AAAA,MACvB,OAAO,MAAM,SAAS;AAChB,YAAA,CAAC,QAAQ,SAAS;AAAM;AAC5B,cAAM,KAAK;AAAA,MACb;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/HF,GAAG,WAAW,eAAe;"}
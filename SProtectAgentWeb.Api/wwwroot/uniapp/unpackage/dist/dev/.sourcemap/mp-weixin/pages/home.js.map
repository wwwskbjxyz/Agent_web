{"version":3,"file":"home.js","sources":["pages/home.vue","E:/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS52dWU"],"sourcesContent":["<template>\r\n  <view class=\"page\" v-if=\"platform.isAuthenticated\">\r\n    <scroll-view scroll-y class=\"content\">\r\n      <view class=\"section\">\r\n        <view class=\"section-header\">\r\n          <text class=\"section-title\">已绑定的软件</text>\r\n          <button class=\"link\" @tap=\"goBind\">绑定软件码</button>\r\n        </view>\r\n\r\n        <view class=\"binding-list\">\r\n          <view\r\n            v-for=\"item in platform.bindings\"\r\n            :key=\"item.bindingId\"\r\n            :class=\"['binding-card', platform.selectedBinding?.bindingId === item.bindingId ? 'active' : '']\"\r\n            @tap=\"select(item)\"\r\n          >\r\n            <view class=\"binding-head\">\r\n              <text class=\"binding-code\">{{ item.authorDisplayName || '未命名软件' }}</text>\r\n              <text class=\"binding-type\">{{ item.softwareType }}</text>\r\n            </view>\r\n            <text class=\"binding-meta\">接口：{{ item.apiAddress }}:{{ item.apiPort }}</text>\r\n            <text class=\"binding-meta\">作者账号：{{ item.authorAccount }}</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n    </scroll-view>\r\n  </view>\r\n  <view v-else class=\"empty\">\r\n    <text>请先登录代理账号。</text>\r\n    <button class=\"link\" @tap=\"goLogin\">前往登录</button>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { onMounted } from 'vue';\r\nimport { usePlatformStore } from '@/stores/platform';\r\nimport { useAppStore } from '@/stores/app';\r\n\r\nconst platform = usePlatformStore();\r\nconst appStore = useAppStore();\r\n\r\nonMounted(async () => {\r\n  if (!platform.isAuthenticated) {\r\n    return;\r\n  }\r\n\r\n  if (!platform.bindings.length) {\r\n    await platform.fetchAgentProfile();\r\n  }\r\n\r\n  const active = platform.selectedBinding || platform.bindings[0];\r\n  if (active) {\r\n    appStore\r\n      .login({ username: active.authorAccount, password: active.authorPassword })\r\n      .catch(() => {\r\n        // 忽略自动登录失败，用户可手动登录\r\n      });\r\n  }\r\n});\r\n\r\nfunction select(item: (typeof platform.bindings)[number]) {\r\n  platform.selectBinding(item);\r\n  appStore\r\n    .login({ username: item.authorAccount, password: item.authorPassword })\r\n    .then(() => {\r\n      uni.showToast({ title: '已切换 ' + item.softwareCode, icon: 'success' });\r\n    })\r\n    .catch((error) => {\r\n      const message =\r\n        (error as any)?.message && typeof (error as any).message === 'string'\r\n          ? (error as any).message\r\n          : '自动登录作者端失败，请手动登录';\r\n      uni.showToast({ title: message, icon: 'none' });\r\n    });\r\n}\r\n\r\nfunction goBind() {\r\n  uni.navigateTo({ url: '/pages/agent/bind' });\r\n}\r\n\r\nfunction goLogin() {\r\n  uni.reLaunch({ url: '/pages/login/agent' });\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.page {\r\n  min-height: 100vh;\r\n  padding: 24rpx 24rpx 80rpx;\r\n}\r\n\r\n.content {\r\n  height: 100%;\r\n}\r\n\r\n.section {\r\n  margin-bottom: 32rpx;\r\n  padding: 32rpx 28rpx;\r\n  border-radius: 24rpx;\r\n  background: rgba(15, 23, 42, 0.55);\r\n  border: 1px solid rgba(148, 163, 184, 0.18);\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 24rpx;\r\n}\r\n\r\n.section-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.section-title {\r\n  font-size: 32rpx;\r\n  font-weight: 600;\r\n  color: #f8fafc;\r\n}\r\n\r\n.link {\r\n  padding: 16rpx 24rpx;\r\n  border-radius: 14rpx;\r\n  border: none;\r\n  background: rgba(59, 130, 246, 0.25);\r\n  color: rgba(191, 219, 254, 0.95);\r\n  font-size: 24rpx;\r\n}\r\n\r\n.binding-list {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(280rpx, 1fr));\r\n  gap: 20rpx;\r\n}\r\n\r\n.binding-card {\r\n  padding: 24rpx;\r\n  border-radius: 20rpx;\r\n  background: rgba(15, 23, 42, 0.6);\r\n  border: 1px solid transparent;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12rpx;\r\n  color: rgba(226, 232, 240, 0.85);\r\n}\r\n\r\n.binding-card.active {\r\n  border-color: rgba(96, 165, 250, 0.6);\r\n  box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.35);\r\n}\r\n\r\n.binding-head {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.binding-code {\r\n  font-size: 30rpx;\r\n  font-weight: 600;\r\n  color: #f8fafc;\r\n  max-width: 420rpx;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n.binding-type {\r\n  font-size: 24rpx;\r\n  color: rgba(148, 163, 184, 0.8);\r\n}\r\n\r\n.binding-meta {\r\n  font-size: 24rpx;\r\n  color: rgba(148, 163, 184, 0.75);\r\n}\r\n\r\n.empty {\r\n  min-height: 100vh;\r\n  padding: 80rpx 40rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 24rpx;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: rgba(226, 232, 240, 0.85);\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Administrator/source/repos/wwwskbjxyz/SPTEST-V1/SProtectAgentWeb.Api/wwwroot/uniapp/pages/home.vue'\nwx.createPage(MiniProgramPage)"],"names":["usePlatformStore","useAppStore","onMounted","uni"],"mappings":";;;;;;;AAuCA,UAAM,WAAWA,gBAAAA;AACjB,UAAM,WAAWC,WAAAA;AAEjBC,kBAAAA,UAAU,YAAY;AAChB,UAAA,CAAC,SAAS,iBAAiB;AAC7B;AAAA,MACF;AAEI,UAAA,CAAC,SAAS,SAAS,QAAQ;AAC7B,cAAM,SAAS;MACjB;AAEA,YAAM,SAAS,SAAS,mBAAmB,SAAS,SAAS,CAAC;AAC9D,UAAI,QAAQ;AAEP,iBAAA,MAAM,EAAE,UAAU,OAAO,eAAe,UAAU,OAAO,gBAAgB,EACzE,MAAM,MAAM;AAAA,QAAA,CAEZ;AAAA,MACL;AAAA,IAAA,CACD;AAED,aAAS,OAAO,MAA0C;AACxD,eAAS,cAAc,IAAI;AAExB,eAAA,MAAM,EAAE,UAAU,KAAK,eAAe,UAAU,KAAK,gBAAgB,EACrE,KAAK,MAAM;AACNC,4BAAA,UAAU,EAAE,OAAO,SAAS,KAAK,cAAc,MAAM,WAAW;AAAA,MAAA,CACrE,EACA,MAAM,CAAC,UAAU;AACV,cAAA,WACH,+BAAe,YAAW,OAAQ,MAAc,YAAY,WACxD,MAAc,UACf;AACNA,sBAAA,MAAI,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAAA,MAAA,CAC/C;AAAA,IACL;AAEA,aAAS,SAAS;AAChBA,oBAAAA,MAAI,WAAW,EAAE,KAAK,oBAAqB,CAAA;AAAA,IAC7C;AAEA,aAAS,UAAU;AACjBA,oBAAAA,MAAI,SAAS,EAAE,KAAK,qBAAsB,CAAA;AAAA,IAC5C;;;;;;;;;;;;;;;;;;;;;;;;;;AClFA,GAAG,WAAW,eAAe;"}
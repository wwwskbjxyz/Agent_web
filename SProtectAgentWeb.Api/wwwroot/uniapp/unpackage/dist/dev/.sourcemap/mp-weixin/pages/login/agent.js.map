{"version":3,"file":"agent.js","sources":["pages/login/agent.vue","E:/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vYWdlbnQudnVl"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <view class=\"glass-card card\">\r\n      <view class=\"header\">\r\n        <text class=\"badge\">代理中心</text>\r\n        <text class=\"title\">登录 / 注册代理账号</text>\r\n        <text class=\"subtitle\">\r\n          默认展示登录表单，可通过上方标签切换至注册。注册仅需一次，需填写邮箱并绑定首个软件码，后续即可在此直接登录使用。\r\n        </text>\r\n      </view>\r\n\r\n      <view class=\"tabs\">\r\n        <button :class=\"['tab', mode === 'login' ? 'active' : '']\" @tap=\"mode = 'login'\">登录</button>\r\n        <button :class=\"['tab', mode === 'register' ? 'active' : '']\" @tap=\"mode = 'register'\">注册</button>\r\n      </view>\r\n\r\n      <view class=\"form\">\r\n        <view class=\"form-item\" v-if=\"mode === 'login'\">\r\n          <text class=\"label\">用户名 / 邮箱</text>\r\n          <input\r\n            v-model=\"form.account\"\r\n            class=\"input\"\r\n            placeholder=\"请输入用户名或邮箱\"\r\n            keyboard-type=\"email\"\r\n          />\r\n        </view>\r\n\r\n        <view class=\"form-item\" v-else>\r\n          <text class=\"label\">用户名</text>\r\n          <input v-model=\"form.username\" class=\"input\" placeholder=\"用于登录与展示\" />\r\n        </view>\r\n\r\n        <view class=\"form-item\" v-if=\"mode === 'register'\">\r\n          <text class=\"label\">邮箱</text>\r\n          <input v-model=\"form.email\" class=\"input\" placeholder=\"接收通知与找回密码\" keyboard-type=\"email\" />\r\n        </view>\r\n\r\n        <view class=\"form-item\">\r\n          <text class=\"label\">密码</text>\r\n          <input v-model=\"form.password\" class=\"input\" placeholder=\"至少 6 位密码\" password />\r\n        </view>\r\n\r\n        <template v-if=\"mode === 'register'\">\r\n          <view class=\"form-item\">\r\n            <text class=\"label\">绑定软件码</text>\r\n            <input v-model=\"form.softwareCode\" class=\"input\" placeholder=\"请输入作者提供的软件码\" />\r\n          </view>\r\n          <view class=\"form-item\">\r\n            <text class=\"label\">作者账号</text>\r\n            <input v-model=\"form.authorAccount\" class=\"input\" placeholder=\"用于转发到作者端的账号\" />\r\n          </view>\r\n          <view class=\"form-item\">\r\n            <text class=\"label\">作者密码</text>\r\n            <input v-model=\"form.authorPassword\" class=\"input\" placeholder=\"用于转发到作者端的密码\" password />\r\n          </view>\r\n        </template>\r\n      </view>\r\n\r\n      <button class=\"submit\" :disabled=\"isBusy\" @tap=\"handleSubmit\">\r\n        {{ mode === 'login' ? (isBusy ? '登录中...' : '立即登录') : isBusy ? '注册中...' : '完成注册' }}\r\n      </button>\r\n\r\n      <view class=\"extra\">\r\n        <button class=\"link\" @tap=\"back\">返回入口</button>\r\n        <button\r\n          class=\"link primary\"\r\n          :disabled=\"wechatLoginBusy\"\r\n          @tap=\"handleWeChatLogin\"\r\n        >\r\n          {{ wechatLoginBusy ? '微信登录中...' : '微信快捷登录' }}\r\n        </button>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, reactive, ref } from 'vue';\r\nimport { usePlatformStore } from '@/stores/platform';\r\n\r\nconst platform = usePlatformStore();\r\nconst mode = ref<'login' | 'register'>('login');\r\nconst form = reactive({\r\n  account: '',\r\n  username: '',\r\n  email: '',\r\n  password: '',\r\n  softwareCode: '',\r\n  authorAccount: '',\r\n  authorPassword: ''\r\n});\r\n\r\nconst isWeChatMiniProgram = ref(false);\r\n\r\nisWeChatMiniProgram.value = true;\r\n\r\n\r\nconst isBusy = computed(() =>\r\n  mode.value === 'login' ? platform.loading.loginAgent : platform.loading.registerAgent\r\n);\r\nconst wechatLoginBusy = computed(() => platform.loading.loginAgentWeChat);\r\n\r\nasync function handleSubmit() {\r\n  if (mode.value === 'register') {\r\n    if (!form.username || !form.email || !form.password || !form.softwareCode || !form.authorAccount || !form.authorPassword) {\r\n      uni.showToast({ title: '请完整填写注册信息', icon: 'none' });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await platform.registerAgent({\r\n        username: form.username.trim(),\r\n        email: form.email.trim(),\r\n        password: form.password,\r\n        softwareCode: form.softwareCode.trim().toUpperCase(),\r\n        authorAccount: form.authorAccount.trim(),\r\n        authorPassword: form.authorPassword\r\n      });\r\n      uni.showToast({ title: '注册成功，请登录', icon: 'success' });\r\n      form.account = form.email.trim();\r\n      form.password = '';\r\n      form.softwareCode = '';\r\n      form.authorAccount = '';\r\n      form.authorPassword = '';\r\n      mode.value = 'login';\r\n      return;\r\n    } catch (error) {\r\n      const message =\r\n        (error as any)?.message && typeof (error as any).message === 'string'\r\n          ? (error as any).message\r\n          : '注册失败，请稍后重试';\r\n      uni.showToast({ title: message, icon: 'none' });\r\n      return;\r\n    }\r\n  }\r\n\r\n  if (!form.account || !form.password) {\r\n    uni.showToast({ title: '请完整填写信息', icon: 'none' });\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const session = await platform.loginAgent({\r\n      account: form.account.trim(),\r\n      password: form.password\r\n    });\r\n    if (session?.bindings?.length) {\r\n      uni.reLaunch({ url: '/pages/index/index' });\r\n    } else {\r\n      uni.showModal({\r\n        title: '登录成功',\r\n        content: '您还没有绑定任何作者软件码，是否现在绑定？',\r\n        success(res) {\r\n          if (res.confirm) {\r\n            uni.navigateTo({ url: '/pages/agent/bind' });\r\n          } else {\r\n            uni.reLaunch({ url: '/pages/index/index' });\r\n          }\r\n        }\r\n      });\r\n    }\r\n  } catch (error) {\r\n    const message =\r\n      (error as any)?.message && typeof (error as any).message === 'string'\r\n        ? (error as any).message\r\n        : '操作失败，请稍后重试';\r\n    uni.showToast({ title: message, icon: 'none' });\r\n  }\r\n}\r\n\r\nfunction back() {\r\n  uni.reLaunch({ url: '/pages/login/index' });\r\n}\r\n\r\nasync function handleWeChatLogin() {\r\n  if (!isWeChatMiniProgram.value) {\r\n    uni.showToast({ title: '请在微信小程序内使用微信登录', icon: 'none' });\r\n    return;\r\n  }\r\n\r\n  if (wechatLoginBusy.value) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const jsCode = await new Promise<string>((resolve, reject) => {\r\n      uni.login({\r\n        provider: 'weixin',\r\n        onlyAuthorize: true,\r\n        success: (res) => {\r\n          if (res.code) {\r\n            resolve(res.code);\r\n          } else {\r\n            reject(new Error('未获取到登录凭证'));\r\n          }\r\n        },\r\n        fail: (error) => reject(error)\r\n      });\r\n    });\r\n\r\n    await platform.loginAgentWithWeChat(jsCode);\r\n    uni.reLaunch({ url: '/pages/index/index' });\r\n  } catch (error) {\r\n    const message =\r\n      (error as any)?.errMsg ||\r\n      (error as any)?.message ||\r\n      '微信登录失败，请稍后再试';\r\n    uni.showToast({ title: message, icon: 'none' });\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.page {\r\n  min-height: 100vh;\r\n  padding: 80rpx 40rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.card {\r\n  width: min(720rpx, 100%);\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 32rpx;\r\n  padding: 48rpx 40rpx;\r\n}\r\n\r\n.header {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 16rpx;\r\n}\r\n\r\n.badge {\r\n  align-self: flex-start;\r\n  padding: 12rpx 28rpx;\r\n  border-radius: 999rpx;\r\n  background: rgba(59, 130, 246, 0.18);\r\n  color: rgba(96, 165, 250, 0.95);\r\n  font-size: 22rpx;\r\n  letter-spacing: 0.08em;\r\n}\r\n\r\n.title {\r\n  font-size: 44rpx;\r\n  font-weight: 600;\r\n  color: #f8fafc;\r\n}\r\n\r\n.subtitle {\r\n  font-size: 24rpx;\r\n  color: rgba(226, 232, 240, 0.7);\r\n  line-height: 1.6;\r\n}\r\n\r\n.tabs {\r\n  display: flex;\r\n  gap: 20rpx;\r\n  padding: 6rpx;\r\n  border-radius: 16rpx;\r\n  background: rgba(30, 41, 59, 0.6);\r\n}\r\n\r\n.tab {\r\n  flex: 1;\r\n  padding: 20rpx 0;\r\n  border-radius: 12rpx;\r\n  background: transparent;\r\n  color: rgba(148, 163, 184, 0.9);\r\n  border: none;\r\n  font-size: 26rpx;\r\n  font-weight: 500;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.tab.active {\r\n  background: linear-gradient(135deg, #6366f1, #8b5cf6);\r\n  color: #fff;\r\n}\r\n\r\n.form {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 24rpx;\r\n}\r\n\r\n.form-item {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12rpx;\r\n}\r\n\r\n.label {\r\n  font-size: 24rpx;\r\n  color: rgba(148, 163, 184, 0.85);\r\n}\r\n\r\n.input {\r\n  padding: 18rpx 24rpx;\r\n  border-radius: 16rpx;\r\n  background: rgba(15, 23, 42, 0.55);\r\n  border: 1px solid rgba(148, 163, 184, 0.2);\r\n  color: #e2e8f0;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.submit {\r\n  margin-top: 8rpx;\r\n  width: 100%;\r\n  padding: 24rpx 0;\r\n  border-radius: 18rpx;\r\n  background: linear-gradient(135deg, #22d3ee, #6366f1);\r\n  color: #fff;\r\n  font-size: 28rpx;\r\n  font-weight: 600;\r\n  border: none;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.extra {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 16rpx;\r\n}\r\n\r\n.link {\r\n  width: 100%;\r\n  padding: 20rpx 0;\r\n  border-radius: 14rpx;\r\n  background: rgba(148, 163, 184, 0.15);\r\n  color: rgba(226, 232, 240, 0.9);\r\n  border: none;\r\n  font-size: 24rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n\r\n  &.primary {\r\n    background: linear-gradient(135deg, #38bdf8, #6366f1);\r\n    color: #fff;\r\n\r\n    &:disabled {\r\n      opacity: 0.6;\r\n    }\r\n  }\r\n}\r\n\r\nbutton::after {\r\n  border: none;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Administrator/source/repos/wwwskbjxyz/SPTEST-V1/SProtectAgentWeb.Api/wwwroot/uniapp/pages/login/agent.vue'\nwx.createPage(MiniProgramPage)"],"names":["usePlatformStore","ref","reactive","computed","uni"],"mappings":"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"}
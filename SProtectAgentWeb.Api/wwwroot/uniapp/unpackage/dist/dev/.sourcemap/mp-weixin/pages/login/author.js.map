{"version":3,"file":"author.js","sources":["pages/login/author.vue","E:/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vYXV0aG9yLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <view class=\"glass-card card\">\r\n      <view class=\"header\">\r\n        <text class=\"badge\">作者管理</text>\r\n        <text class=\"title\">注册 / 登录作者端</text>\r\n        <text class=\"subtitle\">\r\n          默认展示登录表单，可通过上方标签在“登录”和“注册”之间切换。完成注册后即可在此处直接登录并管理您的软件码。\r\n        </text>\r\n      </view>\r\n\r\n      <view class=\"tabs\">\r\n        <button :class=\"['tab', mode === 'login' ? 'active' : '']\" @tap=\"mode = 'login'\">登录</button>\r\n        <button :class=\"['tab', mode === 'register' ? 'active' : '']\" @tap=\"mode = 'register'\">注册</button>\r\n      </view>\r\n\r\n      <view class=\"form\">\r\n        <view class=\"form-item\" v-if=\"mode === 'login'\">\r\n          <text class=\"label\">用户名 / 邮箱</text>\r\n          <input v-model=\"form.account\" class=\"input\" placeholder=\"请输入用户名或邮箱\" />\r\n        </view>\r\n        <view class=\"form-item\" v-else>\r\n          <text class=\"label\">用户名</text>\r\n          <input v-model=\"form.username\" class=\"input\" placeholder=\"设置作者登录用户名\" />\r\n        </view>\r\n        <view class=\"form-item\" v-if=\"mode === 'register'\">\r\n          <text class=\"label\">邮箱</text>\r\n          <input v-model=\"form.email\" class=\"input\" placeholder=\"接收通知与找回密码的邮箱\" />\r\n        </view>\r\n        <view class=\"form-item\">\r\n          <text class=\"label\">密码</text>\r\n          <input v-model=\"form.password\" class=\"input\" placeholder=\"至少 6 位密码\" password />\r\n        </view>\r\n        <view class=\"form-item\" v-if=\"mode === 'register'\">\r\n          <text class=\"label\">展示名称</text>\r\n          <input v-model=\"form.displayName\" class=\"input\" placeholder=\"作者昵称或公司名\" />\r\n        </view>\r\n        <view class=\"form-item\" v-if=\"mode === 'register'\">\r\n          <text class=\"label\">接口地址</text>\r\n          <input v-model=\"form.apiAddress\" class=\"input\" placeholder=\"部署主机 IP 或域名\" />\r\n        </view>\r\n        <view class=\"form-item\" v-if=\"mode === 'register'\">\r\n          <text class=\"label\">接口端口</text>\r\n          <input v-model.number=\"form.apiPort\" class=\"input\" type=\"number\" placeholder=\"如：8080\" />\r\n        </view>\r\n        <view class=\"form-item\" v-if=\"mode === 'register'\">\r\n          <text class=\"label\">软件类型</text>\r\n          <picker :range=\"softwareTypes\" range-key=\"label\" @change=\"handleTypeChange\">\r\n            <view class=\"picker\">{{ currentSoftwareType.label }}</view>\r\n          </picker>\r\n        </view>\r\n      </view>\r\n\r\n      <button class=\"submit\" :disabled=\"isBusy\" @tap=\"handleSubmit\">\r\n        {{ mode === 'login' ? (isBusy ? '登录中...' : '立即登录') : isBusy ? '注册中...' : '提交注册' }}\r\n      </button>\r\n\r\n      <view class=\"hint\" v-if=\"mode === 'login' && profile\">\r\n        <text>软件码：{{ profile.softwareCode }}</text>\r\n        <text>接口：{{ profile.apiAddress }}:{{ profile.apiPort }}</text>\r\n      </view>\r\n\r\n      <button class=\"link\" @tap=\"back\">返回入口</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, reactive, ref } from 'vue';\r\nimport { usePlatformStore } from '@/stores/platform';\r\nimport type { PlatformAuthorProfile } from '@/common/types';\r\n\r\nconst platform = usePlatformStore();\r\nconst mode = ref<'login' | 'register'>('login');\r\nconst profile = ref<PlatformAuthorProfile | null>(null);\r\nconst form = reactive({\r\n  account: '',\r\n  username: '',\r\n  email: '',\r\n  password: '',\r\n  displayName: '',\r\n  apiAddress: '',\r\n  apiPort: 8080,\r\n  softwareType: 'SP'\r\n});\r\n\r\nconst softwareTypes = [\r\n  { value: 'SP', label: 'SProtect (默认)' },\r\n  { value: 'QP', label: 'QProtect' },\r\n  { value: 'API', label: '自定义 API' }\r\n];\r\n\r\nconst currentSoftwareType = computed(() => {\r\n  return softwareTypes.find((item) => item.value === form.softwareType) ?? softwareTypes[0];\r\n});\r\n\r\nconst isBusy = computed(() =>\r\n  mode.value === 'login' ? platform.loading.loginAuthor : platform.loading.registerAuthor\r\n);\r\n\r\nfunction handleTypeChange(event: any) {\r\n  const index = Number(event.detail.value ?? 0);\r\n  const target = softwareTypes[index] ?? softwareTypes[0];\r\n  form.softwareType = target.value;\r\n}\r\n\r\nasync function handleSubmit() {\r\n  if (mode.value === 'register') {\r\n    if (!form.username || !form.email || !form.password || !form.displayName || !form.apiAddress) {\r\n      uni.showToast({ title: '请完整填写注册信息', icon: 'none' });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await platform.registerAuthor({\r\n        username: form.username.trim(),\r\n        email: form.email.trim(),\r\n        password: form.password,\r\n        displayName: form.displayName.trim(),\r\n        apiAddress: form.apiAddress.trim(),\r\n        apiPort: form.apiPort,\r\n        softwareType: form.softwareType\r\n      });\r\n      profile.value = result;\r\n      uni.showToast({ title: '注册成功，请登录', icon: 'success' });\r\n      form.account = form.email.trim();\r\n      form.password = '';\r\n      mode.value = 'login';\r\n      return;\r\n    } catch (error) {\r\n      const message =\r\n        (error as any)?.message && typeof (error as any).message === 'string'\r\n          ? (error as any).message\r\n          : '操作失败，请稍后重试';\r\n      uni.showToast({ title: message, icon: 'none' });\r\n      return;\r\n    }\r\n  }\r\n\r\n  if (!form.account || !form.password) {\r\n    uni.showToast({ title: '请完整填写信息', icon: 'none' });\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const result = await platform.loginAuthor({ account: form.account.trim(), password: form.password });\r\n    profile.value = result;\r\n    uni.showToast({ title: '登录成功', icon: 'success' });\r\n    await platform.fetchAuthorProfile();\r\n    uni.reLaunch({ url: '/pages/author/dashboard' });\r\n  } catch (error) {\r\n    const message =\r\n      (error as any)?.message && typeof (error as any).message === 'string'\r\n        ? (error as any).message\r\n        : '操作失败，请稍后重试';\r\n    uni.showToast({ title: message, icon: 'none' });\r\n  }\r\n}\r\n\r\nfunction back() {\r\n  uni.reLaunch({ url: '/pages/login/index' });\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.page {\r\n  min-height: 100vh;\r\n  padding: 80rpx 40rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.card {\r\n  width: min(760rpx, 100%);\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 32rpx;\r\n  padding: 48rpx 40rpx;\r\n}\r\n\r\n.header {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 16rpx;\r\n}\r\n\r\n.badge {\r\n  align-self: flex-start;\r\n  padding: 12rpx 28rpx;\r\n  border-radius: 999rpx;\r\n  background: rgba(59, 130, 246, 0.18);\r\n  color: rgba(96, 165, 250, 0.95);\r\n  font-size: 22rpx;\r\n  letter-spacing: 0.08em;\r\n}\r\n\r\n.title {\r\n  font-size: 44rpx;\r\n  font-weight: 600;\r\n  color: #f8fafc;\r\n}\r\n\r\n.subtitle {\r\n  font-size: 24rpx;\r\n  color: rgba(226, 232, 240, 0.72);\r\n  line-height: 1.6;\r\n}\r\n\r\n.tabs {\r\n  display: flex;\r\n  gap: 20rpx;\r\n  padding: 6rpx;\r\n  border-radius: 16rpx;\r\n  background: rgba(30, 41, 59, 0.6);\r\n}\r\n\r\n.tab {\r\n  flex: 1;\r\n  padding: 20rpx 0;\r\n  border-radius: 12rpx;\r\n  background: transparent;\r\n  color: rgba(148, 163, 184, 0.9);\r\n  border: none;\r\n  font-size: 26rpx;\r\n  font-weight: 500;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.tab.active {\r\n  background: linear-gradient(135deg, #6366f1, #8b5cf6);\r\n  color: #fff;\r\n}\r\n\r\n.form {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 24rpx;\r\n}\r\n\r\n.form-item {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12rpx;\r\n}\r\n\r\n.label {\r\n  font-size: 24rpx;\r\n  color: rgba(148, 163, 184, 0.85);\r\n}\r\n\r\n.input {\r\n  padding: 18rpx 24rpx;\r\n  border-radius: 16rpx;\r\n  background: rgba(15, 23, 42, 0.55);\r\n  border: 1px solid rgba(148, 163, 184, 0.2);\r\n  color: #e2e8f0;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.picker {\r\n  padding: 18rpx 24rpx;\r\n  border-radius: 16rpx;\r\n  background: rgba(15, 23, 42, 0.55);\r\n  border: 1px solid rgba(148, 163, 184, 0.2);\r\n  color: #e2e8f0;\r\n  font-size: 26rpx;\r\n}\r\n\r\n.submit {\r\n  width: 100%;\r\n  padding: 24rpx 0;\r\n  border-radius: 18rpx;\r\n  background: linear-gradient(135deg, #22d3ee, #6366f1);\r\n  color: #fff;\r\n  font-size: 28rpx;\r\n  font-weight: 600;\r\n  border: none;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.hint {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8rpx;\r\n  padding: 24rpx;\r\n  border-radius: 18rpx;\r\n  background: rgba(15, 23, 42, 0.45);\r\n  border: 1px dashed rgba(94, 234, 212, 0.35);\r\n  color: rgba(125, 211, 252, 0.95);\r\n  font-size: 24rpx;\r\n}\r\n\r\n.link {\r\n  width: 100%;\r\n  padding: 20rpx 0;\r\n  border-radius: 14rpx;\r\n  background: rgba(148, 163, 184, 0.15);\r\n  color: rgba(226, 232, 240, 0.9);\r\n  border: none;\r\n  font-size: 24rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\nbutton::after {\r\n  border: none;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Administrator/source/repos/wwwskbjxyz/SPTEST-V1/SProtectAgentWeb.Api/wwwroot/uniapp/pages/login/author.vue'\nwx.createPage(MiniProgramPage)"],"names":["usePlatformStore","ref","reactive","computed","uni"],"mappings":"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"}
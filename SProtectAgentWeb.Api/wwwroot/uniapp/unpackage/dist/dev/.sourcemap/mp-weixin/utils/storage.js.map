{"version":3,"file":"storage.js","sources":["utils/storage.ts"],"sourcesContent":["const TOKEN_KEY = 'SProtect:authToken';\r\nconst PLATFORM_TOKEN_KEY = 'SProtect:platformToken';\r\nconst AUTHOR_TOKEN_KEY = 'SProtect:authorToken';\r\nconst SELECTED_SOFTWARE_KEY = 'SProtect:selectedSoftware';\r\nconst SELECTED_SOFTWARE_DISPLAY_KEY = 'SProtect:selectedSoftwareDisplay';\r\nconst THEME_KEY = 'SProtect:theme';\r\nconst WECHAT_SUBSCRIPTIONS_KEY = 'SProtect:wechatSubscriptions';\r\n\r\nexport type ThemePreference = 'dark' | 'light' | 'cartoon';\r\n\r\nexport function setTokenValue(token: string) {\r\n  if (!token) {\r\n    uni.removeStorageSync(TOKEN_KEY);\r\n    return;\r\n  }\r\n  uni.setStorageSync(TOKEN_KEY, token);\r\n}\r\n\r\nexport function getTokenValue(): string | null {\r\n  try {\r\n    const value = uni.getStorageSync(TOKEN_KEY);\r\n    return value || null;\r\n  } catch (error) {\r\n    console.warn('读取 Token 失败', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function clearToken() {\r\n  uni.removeStorageSync(TOKEN_KEY);\r\n}\r\n\r\nexport function getTokenStorageKey() {\r\n  return TOKEN_KEY;\r\n}\r\n\r\nexport function setPlatformToken(token: string) {\r\n  if (!token) {\r\n    uni.removeStorageSync(PLATFORM_TOKEN_KEY);\r\n    return;\r\n  }\r\n  uni.setStorageSync(PLATFORM_TOKEN_KEY, token);\r\n}\r\n\r\nexport function getPlatformToken(): string | null {\r\n  try {\r\n    const value = uni.getStorageSync(PLATFORM_TOKEN_KEY);\r\n    return value || null;\r\n  } catch (error) {\r\n    console.warn('读取平台 Token 失败', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function clearPlatformToken() {\r\n  uni.removeStorageSync(PLATFORM_TOKEN_KEY);\r\n}\r\n\r\nexport function setAuthorToken(token: string) {\r\n  if (!token) {\r\n    uni.removeStorageSync(AUTHOR_TOKEN_KEY);\r\n    return;\r\n  }\r\n  uni.setStorageSync(AUTHOR_TOKEN_KEY, token);\r\n}\r\n\r\nexport function getAuthorToken(): string | null {\r\n  try {\r\n    const value = uni.getStorageSync(AUTHOR_TOKEN_KEY);\r\n    return value || null;\r\n  } catch (error) {\r\n    console.warn('读取作者 Token 失败', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function clearAuthorToken() {\r\n  uni.removeStorageSync(AUTHOR_TOKEN_KEY);\r\n}\r\n\r\nexport function setSelectedSoftwareName(value?: string | null) {\r\n  const target = typeof value === 'string' ? value.trim() : '';\r\n  if (!target) {\r\n    try {\r\n      uni.removeStorageSync(SELECTED_SOFTWARE_KEY);\r\n    } catch (error) {\r\n      console.warn('清除软件位缓存失败', error);\r\n    }\r\n    clearSelectedSoftwareDisplayName();\r\n    return;\r\n  }\r\n  try {\r\n    uni.setStorageSync(SELECTED_SOFTWARE_KEY, target);\r\n  } catch (error) {\r\n    console.warn('保存软件位失败', error);\r\n  }\r\n}\r\n\r\nexport function getSelectedSoftwareName(): string | null {\r\n  try {\r\n    const value = uni.getStorageSync(SELECTED_SOFTWARE_KEY);\r\n    if (typeof value === 'string') {\r\n      const normalized = value.trim();\r\n      if (normalized) {\r\n        return normalized;\r\n      }\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.warn('读取软件位失败', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function clearSelectedSoftwareName() {\r\n  try {\r\n    uni.removeStorageSync(SELECTED_SOFTWARE_KEY);\r\n  } catch (error) {\r\n    console.warn('清除软件位失败', error);\r\n  }\r\n}\r\n\r\nexport function setSelectedSoftwareDisplayName(value?: string | null) {\r\n  const target = typeof value === 'string' ? value.trim() : '';\r\n  try {\r\n    if (!target) {\r\n      uni.removeStorageSync(SELECTED_SOFTWARE_DISPLAY_KEY);\r\n    } else {\r\n      uni.setStorageSync(SELECTED_SOFTWARE_DISPLAY_KEY, target);\r\n    }\r\n  } catch (error) {\r\n    console.warn('保存展示软件位失败', error);\r\n  }\r\n}\r\n\r\nexport function getSelectedSoftwareDisplayName(): string | null {\r\n  try {\r\n    const value = uni.getStorageSync(SELECTED_SOFTWARE_DISPLAY_KEY);\r\n    if (typeof value === 'string') {\r\n      const normalized = value.trim();\r\n      if (normalized) {\r\n        return normalized;\r\n      }\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.warn('读取展示软件位失败', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function clearSelectedSoftwareDisplayName() {\r\n  try {\r\n    uni.removeStorageSync(SELECTED_SOFTWARE_DISPLAY_KEY);\r\n  } catch (error) {\r\n    console.warn('清除展示软件位失败', error);\r\n  }\r\n}\r\n\r\nexport function setThemePreference(value: ThemePreference) {\r\n  try {\r\n    uni.setStorageSync(THEME_KEY, value);\r\n  } catch (error) {\r\n    console.warn('保存主题偏好失败', error);\r\n  }\r\n}\r\n\r\nexport function getThemePreference(): ThemePreference {\r\n  try {\r\n    const value = uni.getStorageSync(THEME_KEY);\r\n    if (typeof value === 'string') {\r\n      const normalized = value.trim().toLowerCase();\r\n      if (['dark', 'light', 'cartoon'].includes(normalized)) {\r\n        return normalized as ThemePreference;\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.warn('读取主题偏好失败', error);\r\n  }\r\n  return 'dark';\r\n}\r\n\r\nfunction readWeChatSubscriptionMap(): Record<string, Record<string, boolean>> {\r\n  try {\r\n    const raw = uni.getStorageSync(WECHAT_SUBSCRIPTIONS_KEY);\r\n    if (typeof raw === 'string' && raw.trim()) {\r\n      const parsed = JSON.parse(raw);\r\n      if (parsed && typeof parsed === 'object') {\r\n        return parsed as Record<string, Record<string, boolean>>;\r\n      }\r\n    }\r\n    if (raw && typeof raw === 'object') {\r\n      return raw as Record<string, Record<string, boolean>>;\r\n    }\r\n  } catch (error) {\r\n    console.warn('读取微信订阅偏好失败', error);\r\n  }\r\n  return {};\r\n}\r\n\r\nfunction writeWeChatSubscriptionMap(value: Record<string, Record<string, boolean>>) {\r\n  try {\r\n    uni.setStorageSync(WECHAT_SUBSCRIPTIONS_KEY, JSON.stringify(value));\r\n  } catch (error) {\r\n    console.warn('保存微信订阅偏好失败', error);\r\n  }\r\n}\r\n\r\nexport function getWeChatSubscriptions(openId: string): Record<string, boolean> {\r\n  if (!openId) {\r\n    return {};\r\n  }\r\n  const map = readWeChatSubscriptionMap();\r\n  const preferences = map[openId];\r\n  if (preferences && typeof preferences === 'object') {\r\n    return { ...preferences };\r\n  }\r\n  return {};\r\n}\r\n\r\nexport function setWeChatSubscriptions(openId: string, preferences: Record<string, boolean>) {\r\n  if (!openId) {\r\n    return;\r\n  }\r\n  const map = readWeChatSubscriptionMap();\r\n  map[openId] = { ...preferences };\r\n  writeWeChatSubscriptionMap(map);\r\n}\r\n\r\nexport function clearWeChatSubscriptions(openId: string) {\r\n  if (!openId) {\r\n    return;\r\n  }\r\n  const map = readWeChatSubscriptionMap();\r\n  if (map[openId]) {\r\n    delete map[openId];\r\n    writeWeChatSubscriptionMap(map);\r\n  }\r\n}\r\n"],"names":["uni"],"mappings":";;AAAA,MAAM,YAAY;AAClB,MAAM,qBAAqB;AAC3B,MAAM,mBAAmB;AACzB,MAAM,wBAAwB;AAC9B,MAAM,gCAAgC;AACtC,MAAM,YAAY;AAClB,MAAM,2BAA2B;AAI1B,SAAS,cAAc,OAAe;AAC3C,MAAI,CAAC,OAAO;AACVA,wBAAI,kBAAkB,SAAS;AAC/B;AAAA,EACF;AACIA,gBAAAA,MAAA,eAAe,WAAW,KAAK;AACrC;AAEO,SAAS,gBAA+B;AACzC,MAAA;AACI,UAAA,QAAQA,cAAAA,MAAI,eAAe,SAAS;AAC1C,WAAO,SAAS;AAAA,WACT,OAAO;AACdA,kBAAA,MAAa,MAAA,QAAA,0BAAA,eAAe,KAAK;AAC1B,WAAA;AAAA,EACT;AACF;AAEO,SAAS,aAAa;AAC3BA,sBAAI,kBAAkB,SAAS;AACjC;AAMO,SAAS,iBAAiB,OAAe;AAC9C,MAAI,CAAC,OAAO;AACVA,wBAAI,kBAAkB,kBAAkB;AACxC;AAAA,EACF;AACIA,gBAAAA,MAAA,eAAe,oBAAoB,KAAK;AAC9C;AAEO,SAAS,mBAAkC;AAC5C,MAAA;AACI,UAAA,QAAQA,cAAAA,MAAI,eAAe,kBAAkB;AACnD,WAAO,SAAS;AAAA,WACT,OAAO;AACdA,kBAAA,MAAA,MAAA,QAAA,0BAAa,iBAAiB,KAAK;AAC5B,WAAA;AAAA,EACT;AACF;AAEO,SAAS,qBAAqB;AACnCA,sBAAI,kBAAkB,kBAAkB;AAC1C;AAEO,SAAS,eAAe,OAAe;AAC5C,MAAI,CAAC,OAAO;AACVA,wBAAI,kBAAkB,gBAAgB;AACtC;AAAA,EACF;AACIA,gBAAAA,MAAA,eAAe,kBAAkB,KAAK;AAC5C;AAEO,SAAS,iBAAgC;AAC1C,MAAA;AACI,UAAA,QAAQA,cAAAA,MAAI,eAAe,gBAAgB;AACjD,WAAO,SAAS;AAAA,WACT,OAAO;AACdA,kBAAA,MAAA,MAAA,QAAA,0BAAa,iBAAiB,KAAK;AAC5B,WAAA;AAAA,EACT;AACF;AAEO,SAAS,mBAAmB;AACjCA,sBAAI,kBAAkB,gBAAgB;AACxC;AAEO,SAAS,wBAAwB,OAAuB;AAC7D,QAAM,SAAS,OAAO,UAAU,WAAW,MAAM,KAAS,IAAA;AAC1D,MAAI,CAAC,QAAQ;AACP,QAAA;AACFA,0BAAI,kBAAkB,qBAAqB;AAAA,aACpC,OAAO;AACdA,oBAAA,MAAa,MAAA,QAAA,0BAAA,aAAa,KAAK;AAAA,IACjC;AACiC;AACjC;AAAA,EACF;AACI,MAAA;AACEA,kBAAAA,MAAA,eAAe,uBAAuB,MAAM;AAAA,WACzC,OAAO;AACdA,kBAAA,MAAA,MAAA,QAAA,0BAAa,WAAW,KAAK;AAAA,EAC/B;AACF;AAEO,SAAS,0BAAyC;AACnD,MAAA;AACI,UAAA,QAAQA,cAAAA,MAAI,eAAe,qBAAqB;AAClD,QAAA,OAAO,UAAU,UAAU;AACvB,YAAA,aAAa,MAAM;AACzB,UAAI,YAAY;AACP,eAAA;AAAA,MACT;AAAA,IACF;AACO,WAAA;AAAA,WACA,OAAO;AACdA,kBAAA,MAAA,MAAA,QAAA,2BAAa,WAAW,KAAK;AACtB,WAAA;AAAA,EACT;AACF;AAEO,SAAS,4BAA4B;AACtC,MAAA;AACFA,wBAAI,kBAAkB,qBAAqB;AAAA,WACpC,OAAO;AACdA,kBAAA,MAAA,MAAA,QAAA,2BAAa,WAAW,KAAK;AAAA,EAC/B;AACF;AAEO,SAAS,+BAA+B,OAAuB;AACpE,QAAM,SAAS,OAAO,UAAU,WAAW,MAAM,KAAS,IAAA;AACtD,MAAA;AACF,QAAI,CAAC,QAAQ;AACXA,0BAAI,kBAAkB,6BAA6B;AAAA,IAAA,OAC9C;AACDA,oBAAAA,MAAA,eAAe,+BAA+B,MAAM;AAAA,IAC1D;AAAA,WACO,OAAO;AACdA,kBAAA,MAAa,MAAA,QAAA,2BAAA,aAAa,KAAK;AAAA,EACjC;AACF;AAEO,SAAS,iCAAgD;AAC1D,MAAA;AACI,UAAA,QAAQA,cAAAA,MAAI,eAAe,6BAA6B;AAC1D,QAAA,OAAO,UAAU,UAAU;AACvB,YAAA,aAAa,MAAM;AACzB,UAAI,YAAY;AACP,eAAA;AAAA,MACT;AAAA,IACF;AACO,WAAA;AAAA,WACA,OAAO;AACdA,kBAAA,MAAa,MAAA,QAAA,2BAAA,aAAa,KAAK;AACxB,WAAA;AAAA,EACT;AACF;AAEO,SAAS,mCAAmC;AAC7C,MAAA;AACFA,wBAAI,kBAAkB,6BAA6B;AAAA,WAC5C,OAAO;AACdA,kBAAA,MAAa,MAAA,QAAA,2BAAA,aAAa,KAAK;AAAA,EACjC;AACF;AAEO,SAAS,mBAAmB,OAAwB;AACrD,MAAA;AACEA,kBAAAA,MAAA,eAAe,WAAW,KAAK;AAAA,WAC5B,OAAO;AACdA,kBAAA,MAAA,MAAA,QAAA,2BAAa,YAAY,KAAK;AAAA,EAChC;AACF;AAEO,SAAS,qBAAsC;AAChD,MAAA;AACI,UAAA,QAAQA,cAAAA,MAAI,eAAe,SAAS;AACtC,QAAA,OAAO,UAAU,UAAU;AAC7B,YAAM,aAAa,MAAM,KAAK,EAAE,YAAY;AAC5C,UAAI,CAAC,QAAQ,SAAS,SAAS,EAAE,SAAS,UAAU,GAAG;AAC9C,eAAA;AAAA,MACT;AAAA,IACF;AAAA,WACO,OAAO;AACdA,kBAAA,MAAA,MAAA,QAAA,2BAAa,YAAY,KAAK;AAAA,EAChC;AACO,SAAA;AACT;AAEA,SAAS,4BAAqE;AACxE,MAAA;AACI,UAAA,MAAMA,cAAAA,MAAI,eAAe,wBAAwB;AACvD,QAAI,OAAO,QAAQ,YAAY,IAAI,QAAQ;AACnC,YAAA,SAAS,KAAK,MAAM,GAAG;AACzB,UAAA,UAAU,OAAO,WAAW,UAAU;AACjC,eAAA;AAAA,MACT;AAAA,IACF;AACI,QAAA,OAAO,OAAO,QAAQ,UAAU;AAC3B,aAAA;AAAA,IACT;AAAA,WACO,OAAO;AACdA,kBAAA,MAAa,MAAA,QAAA,2BAAA,cAAc,KAAK;AAAA,EAClC;AACA,SAAO;AACT;AAEA,SAAS,2BAA2B,OAAgD;AAC9E,MAAA;AACFA,kBAAA,MAAI,eAAe,0BAA0B,KAAK,UAAU,KAAK,CAAC;AAAA,WAC3D,OAAO;AACdA,kBAAA,MAAa,MAAA,QAAA,2BAAA,cAAc,KAAK;AAAA,EAClC;AACF;AAEO,SAAS,uBAAuB,QAAyC;AAC9E,MAAI,CAAC,QAAQ;AACX,WAAO;EACT;AACA,QAAM,MAAM;AACN,QAAA,cAAc,IAAI,MAAM;AAC1B,MAAA,eAAe,OAAO,gBAAgB,UAAU;AAC3C,WAAA,EAAE,GAAG;EACd;AACA,SAAO;AACT;AAEgB,SAAA,uBAAuB,QAAgB,aAAsC;AAC3F,MAAI,CAAC,QAAQ;AACX;AAAA,EACF;AACA,QAAM,MAAM;AACZ,MAAI,MAAM,IAAI,EAAE,GAAG,YAAY;AAC/B,6BAA2B,GAAG;AAChC;;;;;;;;;;;;;;;;;;;;"}
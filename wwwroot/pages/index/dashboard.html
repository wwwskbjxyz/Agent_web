<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SProtect 管理面板 · v5</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root { --primary:#6c5ce7; --secondary:#00F0FF; --dark:#0b1220; --darker:#0a0f1a; }
    body { background:#0b1220; color:#d1d5db; }
    .glass { background: rgba(15,23,42,0.7); backdrop-filter: blur(10px); border: 1px solid rgba(108,92,231,0.3); }
    .tab-active { border-bottom: 2px solid var(--secondary); color: var(--secondary); }
    .pagination-item { padding: .25rem .75rem; border-radius:.375rem; }
    .pagination-item.active { background: rgba(0,240,255,.25); color: #0b1220; }
    .btn-primary { background: var(--primary); }
    .btn-primary:hover { opacity: .9; }

    .btn-danger:hover { opacity: .9; }
    .tag { padding: .15rem .5rem; border-radius:.375rem; font-size:.75rem; }
    .tag-green { background:rgba(16,185,129,.15); color:#34d399; }
    .tag-gray  { background:rgba(156,163,175,.15); color:#d1d5db; }
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:50; }
    .modal { width: 100%; max-width: 720px; }
    .form-input { background:#0a0f1a; border:1px solid rgba(108,92,231,.3); border-radius:.5rem; padding:.5rem .75rem; width:100%; }
    .table-row:hover { background: rgba(255,255,255,.04); }
  
/* ==== H5 适配增强 ==== */
table { font-size: 0.875rem; } /* 表格字体更适合手机 */
button, input, select { min-height: 44px; } /* 提高触控舒适度 */
.modal { width: 95%; max-width: 720px; margin: 0 auto; } /* 弹窗自适配 */
@media (max-width: 640px) {
  #trend-chart, #usage-map { height: 240px !important; } /* 图表高度调整 */
  h1, h2 { font-size: 1.25rem; } /* 标题缩小 */
  .text-lg { font-size: 1rem; } /* 副标题缩小 */
}


/* ==== H5 表格适配 ==== */
.table-responsive {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}
.table-responsive table th,
.table-responsive table td {
  white-space: nowrap;
  font-size: 0.75rem;
  padding: 0.5rem 0.75rem;
}
@media (max-width: 640px) {
  .table-responsive table th,
  .table-responsive table td {
    font-size: 0.7rem;
    padding: 0.4rem 0.5rem;
  }
}

/* ==== 公告与地图样式 ==== */
.announcement-card {
  display: none;
  border-left: 3px solid var(--secondary);
}
.announcement-card.active {
  display: block;
}
.announcement-meta {
  font-size: 0.75rem;
  color: rgba(148, 163, 184, 0.9);
}
#usage-map {
  min-height: 20rem;
  background: radial-gradient(circle at top, rgba(56, 189, 248, 0.18), transparent 60%),
              radial-gradient(circle at bottom, rgba(167, 139, 250, 0.1), transparent 65%),
              #0b1220;
  border-radius: 1rem;
  border: 1px solid rgba(56, 189, 248, 0.15);
  position: relative;
}
.map-overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
  border-radius: 1rem;
  box-shadow: inset 0 0 20px rgba(15, 23, 42, 0.65);
}
@media (max-width: 768px) {
  #usage-map { min-height: 16rem; }
}

    .card-actions,
    .agent-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    .desktop-only { display: initial; }
    .mobile-only { display: none !important; }
    .mobile-inline-action { display: none !important; }
    .mobile-hidden-cell { }
    .mobile-detail-cell { display: none; }
    .mobile-detail-btn { width: 100%; font-weight: 500; letter-spacing: 0.02em; }
    .mobile-detail-backdrop { opacity: 0; visibility: hidden; transition: opacity .2s ease, visibility .2s ease; }
    .mobile-detail-backdrop.active { opacity: 1; visibility: visible; }
    .mobile-detail-modal-content { width: min(100%, 480px); max-height: 90vh; overflow-y: auto; transform: translateY(24px); transition: transform .2s ease; }
    .mobile-detail-backdrop.active .mobile-detail-modal-content { transform: translateY(0); }
    .mobile-detail-content { display: flex; flex-direction: column; gap: 0.75rem; }
    .mobile-detail-item { background: rgba(15,23,42,.72); border: 1px solid rgba(148,163,184,.15); border-radius: 0.85rem; padding: 0.75rem; display: flex; flex-direction: column; gap: 0.35rem; }
    .mobile-detail-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: .08em; color: rgba(148,163,184,0.85); }
    .mobile-detail-value { font-size: 0.95rem; color: #e2e8f0; word-break: break-word; }
    .mobile-detail-actions { display: flex; flex-wrap: wrap; justify-content: flex-end; gap: 0.5rem; margin-top: 1rem; }
    .card-key-cell .card-key-text { font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; }
    .card-key-status,
    .agent-status-inline { display: none; }

    @media (min-width: 961px) {
      .mobile-only { display: none !important; }
    }

    @media (max-width: 960px) {
      body { font-size: 15px; }
      .desktop-only { display: none !important; }
      .mobile-only { display: block !important; }
      .mobile-inline-action { display: inline-flex !important; align-items: center; justify-content: center; gap: 0.35rem; }
      .table-responsive { overflow-x: visible; }
      table { width: 100%; }
      table th, table td { white-space: normal; word-break: break-word; }
      .mobile-hidden-cell { display: none !important; }
      .mobile-detail-cell { display: table-cell; width: 1%; }
      .mobile-detail-btn { font-size: 0.85rem; padding: 0.45rem 0.75rem; }
      .card-actions,
      .agent-actions { width: 100%; gap: 0.5rem; }
      .card-status-col,
      .agent-status-col { display: none !important; }
      .card-key-status,
      .agent-status-inline { display: inline-flex; align-items: center; }
      .modal { max-height: 90vh; overflow-y: auto; }
    }

    @media (max-width: 640px) {
      .mobile-detail-modal-content { border-radius: 1.25rem; padding: 1.25rem; }
    }

</style>
</head>
<body data-page="dashboard" class="min-h-screen">
  <!-- Toast -->
  <div id="toast" class="fixed top-4 right-4 glass px-4 py-3 rounded-lg z-50 transform translate-x-full transition-transform duration-300 flex items-center gap-2 max-w-xs">
    <i id="toast-icon" class="fa fa-check-circle text-green-400"></i>
    <span id="toast-message">操作成功</span>
  </div>

  <!-- 系统状态（仅管理员） -->
  <div id="system-status-wrapper" class="hidden px-4 mt-4">
    <div class="max-w-7xl mx-auto">
      <div class="glass rounded-xl p-4">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3">
          <div class="flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-gray-200">
            <span class="font-semibold text-white flex items-center gap-2"><i class="fa fa-desktop text-[var(--secondary)]"></i>服务器状态</span>
            <span>CPU 占用：<span id="system-status-cpu" class="text-white">--</span></span>
            <span>内存占用：<span id="system-status-memory" class="text-white">--</span></span>
            <span>开机时间：<span id="system-status-boot" class="text-white">--</span></span>
            <span>运行时长：<span id="system-status-uptime" class="text-white">--</span></span>
            <span>服务器时间：<span id="system-status-time" class="text-white">--</span></span>
          </div>
          <div class="flex items-center gap-3 text-xs text-gray-400">
            <span id="system-status-updated"></span>
            <button id="system-status-refresh" class="px-3 py-1 glass rounded-lg text-sm whitespace-nowrap"><i class="fa fa-rotate"></i> 刷新</button>
          </div>
        </div>
        <div id="system-status-message" class="text-xs text-amber-300 mt-2 hidden"></div>
      </div>
    </div>
  </div>

  <!-- 登录页 -->
  <div id="login-page" class="min-h-screen flex items-center justify-center p-4">
    <div class="glass rounded-2xl p-8 w-full max-w-md">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-white mb-2"><span class="text-[var(--secondary)]">S</span>Protect</h1>
        <p class="text-gray-400">Agent 管理系统</p>
      </div>
      <form id="login-form" class="space-y-4">
        <div>
          <label class="block text-sm text-gray-400 mb-1">用户名</label>
          <input name="username" type="text" class="form-input" />
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-1">密码</label>
          <div class="relative">
            <input id="password-input" name="password" type="password" class="form-input pr-10" />
            <button id="toggle-password" type="button" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400"><i class="fa fa-eye"></i></button>
          </div>
        </div>
        <button type="submit" class="w-full py-2 rounded-lg btn-primary">登录</button>
      </form>
    </div>
  </div>

  <!-- 软件列表页 -->
  <div id="software-page" class="hidden p-6 max-w-6xl mx-auto">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold">软件列表</h2>
      <div class="flex items-center gap-2">
        <button id="chat-btn" class="px-3 py-2 glass rounded-lg hidden relative">
          <i class="fa fa-comments mr-1"></i>聊天
          <span id="chat-unread-count" class="hidden ml-2 inline-flex items-center justify-center px-2 py-0.5 text-xs rounded-full bg-red-500 text-white">0</span>
        </button>
        <button id="link-records-btn" class="px-3 py-2 glass rounded-lg hidden"><i class="fa fa-link mr-1"></i>链接记录</button>
        <button id="logout-btn" class="px-3 py-2 glass rounded-lg"><i class="fa fa-sign-out-alt mr-1"></i>退出</button>
      </div>
    </div>

    <div id="announcement-card" class="glass rounded-xl p-4 mb-4 announcement-card">
      <div class="flex flex-col gap-2">
        <div class="flex items-center gap-2 text-sm text-[var(--secondary)]">
          <i class="fa fa-bullhorn"></i>
          <span>最新公告</span>
        </div>
        <div id="announcement-content" class="text-sm leading-relaxed text-gray-200 whitespace-pre-wrap"></div>
        <div id="announcement-updated" class="announcement-meta"></div>
      </div>
    </div>

    <div class="glass rounded-xl p-4 mb-4">
      <div class="flex items-center justify-between gap-3">
        <div class="text-lg font-semibold flex items-center gap-2">
          <i class="fa fa-th-large text-[var(--secondary)]"></i>
          <span>软件位概览</span>
        </div>
        <div class="text-xs text-gray-400 hidden sm:block">点击卡片可进入对应软件管理</div>
      </div>
      <div id="software-loading" class="text-gray-400 mt-3 hidden"><i class="fa fa-circle-notch fa-spin mr-2"></i>加载中...</div>
      <div id="software-list" class="mt-4 grid gap-4 md:grid-cols-3 sm:grid-cols-2 grid-cols-1"></div>
    </div>

    <div class="glass rounded-xl p-4 mb-4">
      <div class="flex items-center justify-between gap-3">
        <div class="text-lg font-semibold flex items-center gap-2">
          <i class="fa fa-chart-area text-[var(--secondary)]"></i>
          <span>最近7天激活趋势</span>
        </div>
        <div id="trend-summary" class="text-sm text-gray-400"></div>
      </div>
      <div id="trend-chart" class="mt-4 h-56"></div>
      <div id="trend-empty" class="mt-4 text-center text-gray-500 hidden">暂无数据</div>
    </div>

    <div class="glass rounded-xl p-4 mb-4">
      <div class="flex items-center justify-between gap-3">
        <div class="text-lg font-semibold flex items-center gap-2">
          <i class="fa fa-users-line text-[var(--secondary)]"></i>
          <span>最近子代理7天激活趋势</span>
        </div>
        <div id="subagent-trend-summary" class="text-sm text-gray-400"></div>
      </div>
      <div id="subagent-trend-chart" class="mt-4 h-56"></div>
      <div id="subagent-trend-empty" class="mt-4 text-center text-gray-500 hidden">暂无数据</div>
    </div>

    <div class="glass rounded-xl p-4 mb-4">
      <div class="text-lg font-semibold mb-3 flex items-center gap-2">
        <i class="fa fa-chart-line text-[var(--secondary)]"></i>
        <span>销量查询</span>
      </div>
      <div class="grid gap-3 md:grid-cols-4 sm:grid-cols-2 grid-cols-1">
        <div>
          <label class="block text-sm text-gray-400 mb-1">软件位</label>
          <select id="sales-software" class="form-input"></select>
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-1">卡种</label>
          <select id="sales-cardType" class="form-input"><option value="">全部</option></select>
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-1">状态</label>
          <select id="sales-status" class="form-input">
            <option value="">全部</option>
            <option value="启用">启用</option>
            <option value="禁用">禁用</option>
          </select>
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-1">代理</label>
          <select id="sales-agent" class="form-input"></select>
        </div>
        <div class="flex items-center gap-2">
          <input id="sales-include-sub" type="checkbox" class="h-4 w-4" checked>
          <label for="sales-include-sub" class="text-sm text-gray-300">包含下级代理</label>
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-1">开始时间</label>
          <input id="sales-start" type="datetime-local" class="form-input">
        </div>
        <div>
          <label class="block text-sm text-gray-400 mb-1">结束时间</label>
          <input id="sales-end" type="datetime-local" class="form-input">
        </div>
        <div class="flex items-end gap-2">
          <button id="sales-query" class="px-4 py-2 rounded-lg btn-primary">查询</button>
          <button id="sales-reset" class="px-4 py-2 rounded-lg glass">重置</button>
        </div>
      </div>
      <div id="sales-loading" class="text-gray-400 mt-3 hidden"><i class="fa fa-circle-notch fa-spin mr-2"></i>查询中...</div>
      <div id="sales-error" class="text-red-400 mt-3 hidden"></div>
      <div id="sales-result" class="glass rounded-xl p-4 mt-4 hidden">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          <div class="text-lg font-semibold">激活数量：<span id="sales-count" class="text-[var(--secondary)]">0</span></div>
          <div class="text-sm text-gray-400" id="sales-summary"></div>
        </div>
        <div class="overflow-x-auto mt-4">
          <table class="min-w-full">
            <thead>
              <tr class="bg-white/5">
                <th class="px-4 py-3 text-left text-sm font-medium">卡密</th>
                <th class="px-4 py-3 text-left text-sm font-medium">激活时间</th>
              </tr>
            </thead>
            <tbody id="sales-result-body"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- 管理页 -->
  <div id="management-page" class="hidden p-6 max-w-7xl mx-auto">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <button id="back-to-software" class="px-3 py-2 glass rounded-lg"><i class="fa fa-arrow-left mr-1"></i>返回</button>
        <div class="text-lg font-semibold">当前软件：<span id="current-software-name" class="text-[var(--secondary)]">-</span></div>
      </div>
      <div class="flex items-center gap-2">
        <button id="management-chat-btn" class="px-3 py-2 glass rounded-lg hidden">
          <i class="fa fa-comments mr-1"></i>聊天
          <span id="management-chat-unread" class="hidden ml-2 inline-flex items-center justify-center px-2 py-0.5 text-xs rounded-full bg-red-500 text-white">0</span>
        </button>
        <button id="management-link-records" class="px-3 py-2 glass rounded-lg hidden"><i class="fa fa-link mr-1"></i>链接记录</button>
        <button id="management-logout" class="px-3 py-2 glass rounded-lg"><i class="fa fa-sign-out-alt mr-1"></i>退出</button>
      </div>
    </div>

    <div class="border-b border-white/10 mb-4 flex flex-wrap gap-6">
      <button id="card-tab" class="pb-2 tab-active">卡密管理</button>
      <button id="agent-tab" class="pb-2">代理管理</button>
      <button id="blacklist-log-tab" class="pb-2">黑名单记录</button>
      <button id="blacklist-machine-tab" class="pb-2">黑名单机器码</button>
    </div>

    <!-- 卡密管理（保留上个版本 v4） -->
    <div id="card-section">
      <div class="glass rounded-xl p-4 mb-4">
        <div class="text-lg font-semibold flex items-center gap-2">
          <i class="fa fa-globe-asia text-[var(--secondary)]"></i>
          <span>卡密使用地区分布</span>
        </div>
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mt-3 text-sm text-gray-400">
          <span id="usage-map-summary"></span>
          <button id="usage-refresh" class="px-3 py-1 glass rounded-lg whitespace-nowrap"><i class="fa fa-rotate mr-1"></i>刷新</button>
        </div>
        <div class="mt-4 map-card relative">
          <div id="usage-map" class="w-full"></div>
          <div class="map-overlay"></div>
          <div id="usage-map-empty" class="mt-4 text-center text-gray-500 hidden">暂无数据或缺少位置信息</div>
        </div>
        <div class="mt-4 grid gap-4 md:grid-cols-3 sm:grid-cols-2 grid-cols-1">
          <div>
            <div class="text-sm text-gray-400 mb-2">省份 TOP10</div>
            <div id="usage-province-list" class="space-y-1 text-sm text-gray-300"></div>
          </div>
          <div>
            <div class="text-sm text-gray-400 mb-2">城市 TOP10</div>
            <div id="usage-city-list" class="space-y-1 text-sm text-gray-300"></div>
          </div>
          <div>
            <div class="text-sm text-gray-400 mb-2">区县 TOP10</div>
            <div id="usage-district-list" class="space-y-1 text-sm text-gray-300"></div>
          </div>
        </div>
      </div>

      <div class="glass rounded-xl p-4 mb-4">
        <div class="grid md:grid-cols-8 sm:grid-cols-2 grid-cols-1 gap-3">
          <div class="md:col-span-2">
            <label class="block text-sm mb-1 text-gray-400">whom（代理）</label>
            <select id="filter-whom" class="form-input"></select>
          </div>
          <div>
            <label class="block text-sm mb-1 text-gray-400">卡密类型</label>
            <select id="filter-cardType" class="form-input"><option value="">全部</option></select>
          </div>
          <div>
            <label class="block text-sm mb-1 text-gray-400">状态</label>
            <select id="filter-status" class="form-input"><option value="">全部</option><option value="启用">启用</option><option value="禁用">禁用</option></select>
          </div>
          <div>
            <label class="block text-sm mb-1 text-gray-400">搜索类型</label>
            <select id="filter-searchType" class="form-input"><option value="0">模糊搜索</option><option value="1">卡密（精准）</option><option value="2">IP</option><option value="3">卡密类型</option></select>
          </div>
          <div>
            <label class="block text-sm mb-1 text-gray-400">关键词</label>
            <input id="filter-keyword" type="text" class="form-input" placeholder="模糊/卡密/IP/类型名">
          </div>
          <div class="flex items-end gap-2">
            <button id="filter-apply" class="px-4 py-2 rounded-lg btn-primary">搜索</button>
            <button id="filter-reset" class="px-4 py-2 rounded-lg glass">重置</button>
          </div>
          <div class="flex items-end justify-end md:col-span-2">
            <button id="btn-open-create" class="px-4 py-2 rounded-lg bg-emerald-600 hover:opacity-90"><i class="fa fa-plus mr-2"></i>新增卡密</button>
          </div>
        </div>
      </div>

      <div class="glass rounded-xl overflow-hidden mb-4">
        <div class="table-responsive">
          <table class="min-w-full" data-mobile-table data-mobile-primary="1,8" data-mobile-actions="0" data-mobile-title-col="1" data-mobile-detail-label="详情">
            <thead>
              <tr class="bg-white/5 text-left text-sm font-medium">
                <th class="px-4 py-4 w-32">操作</th>
                <th class="px-4 py-4">卡密</th>
                <th class="px-4 py-4">机器码</th>
                <th class="px-4 py-4">制卡人</th>
                <th class="px-4 py-4">类型</th>
                <th class="px-4 py-4 card-status-col desktop-only">状态</th>
                <th class="px-4 py-4">IP</th>
                <th class="px-4 py-4">激活时间</th>
                <th class="px-4 py-4">到期时间</th>
                <th class="px-4 py-4">生成时间</th>
              </tr>
            </thead>
            <tbody id="card-list">
              <tr><td colspan="10" class="px-6 py-8 text-center text-gray-400">请选择软件位后加载卡密</td></tr>
            </tbody>
          </table>
        </div>
        <div id="card-loading" class="border-t border-white/10 px-4 py-3 text-sm text-gray-400 hidden"><i class="fa fa-circle-notch fa-spin mr-2"></i>加载中...</div>
        <div class="px-4 py-3 border-t border-white/10 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          <div class="text-sm text-gray-400">显示 <span id="card-start-item">0</span>-<span id="card-end-item">0</span> 条，共 <span id="card-total-items">0</span> 条</div>
          <div class="flex items-center gap-1">
            <button id="card-prev" class="pagination-item"><i class="fa fa-angle-left"></i></button>
            <div id="card-pages" class="flex items-center gap-1"></div>
            <button id="card-next" class="pagination-item"><i class="fa fa-angle-right"></i></button>
          </div>
        </div>
      </div>
    </div>

    <!-- 代理管理 -->
    <div id="agent-section" class="hidden">
      <div class="glass rounded-xl p-5 mb-4">
        <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4">
          <div class="flex-1">
            <label class="block text-sm mb-2 text-gray-400">搜索子代理</label>
            <div class="flex flex-col sm:flex-row gap-2">
              <input id="agent-search-keyword" type="text" class="form-input flex-1" placeholder="用户名 / 备注关键词" />
              <button id="agent-search-btn" class="px-4 py-2 rounded-lg btn-primary whitespace-nowrap"><i class="fa fa-search mr-2"></i>搜索</button>
            </div>
          </div>
          <div class="flex flex-wrap gap-2">
            <button id="agent-add-btn" class="px-4 py-2 rounded-lg bg-emerald-600 hover:opacity-90 whitespace-nowrap"><i class="fa fa-plus mr-2"></i>新增代理</button>
            <button id="agent-enable-selected" class="px-4 py-2 rounded-lg glass whitespace-nowrap">批量启用</button>
            <button id="agent-disable-selected" class="px-4 py-2 rounded-lg glass whitespace-nowrap">批量禁用</button>
            <button id="agent-delete-selected" class="px-4 py-2 rounded-lg glass text-red-400 hover:text-red-200 whitespace-nowrap">批量删除</button>
          </div>
        </div>
      </div>

      <div class="glass rounded-xl overflow-hidden">
        <div class="table-responsive">
          <table class="min-w-full" data-mobile-table data-mobile-primary="0,2,5" data-mobile-actions="1" data-mobile-title-col="2" data-mobile-detail-label="详情">
            <thead>
              <tr class="bg-white/5 text-left text-sm font-medium">
                <th class="px-4 py-3 w-12"><input id="agent-check-all" type="checkbox" /></th>
                <th class="px-4 py-3 w-40">操作</th>
                <th class="px-4 py-3">代理账号</th>
                <th class="px-4 py-3 desktop-only">登录密码</th>
                <th class="px-4 py-3 agent-status-col desktop-only">状态</th>
                <th class="px-4 py-3">余额</th>
                <th class="px-4 py-3">库存时长(小时)</th>
                <th class="px-4 py-3">返利率(%)</th>
                <th class="px-4 py-3">累计返利(%)</th>
                <th class="px-4 py-3">到期时间</th>
                <th class="px-4 py-3">备注</th>
              </tr>
            </thead>
            <tbody id="agent-list">
              <tr><td colspan="11" class="px-4 py-6 text-center text-gray-400">请选择软件位后加载子代理</td></tr>
            </tbody>
          </table>
        </div>
        <div class="p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 border-t border-white/10">
          <div class="text-sm text-gray-400">显示 <span id="agent-start">0</span>-<span id="agent-end">0</span> 条，共 <span id="agent-total">0</span> 条</div>
          <div class="flex items-center gap-1">
            <button id="agent-prev" class="pagination-item"><i class="fa fa-angle-left"></i></button>
            <div id="agent-pages" class="flex items-center gap-1"></div>
            <button id="agent-next" class="pagination-item"><i class="fa fa-angle-right"></i></button>
          </div>
        </div>
      </div>
    </div>

    <!-- 黑名单记录 -->
    <div id="blacklist-log-section" class="hidden">
      <div class="glass rounded-xl p-4 mb-4">
        <div class="flex flex-col gap-3">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div class="text-lg font-semibold flex items-center gap-2">
              <i class="fa fa-clipboard-list text-[var(--secondary)]"></i>
              <span>黑名单触发记录</span>
            </div>
            <div class="text-sm text-gray-400 sm:text-right">最近 200 条记录，可在查询参数中调整</div>
          </div>
          <div class="flex flex-col sm:flex-row sm:items-center gap-2">
            <input id="blacklist-log-search" type="text" class="form-input flex-1 sm:w-64" placeholder="输入卡密关键词" />
            <div class="flex items-center gap-2">
              <button id="blacklist-log-search-btn" type="button" class="px-4 py-2 rounded-lg btn-primary"><i class="fa fa-search mr-2"></i>搜索</button>
              <button id="blacklist-log-reset-btn" type="button" class="px-4 py-2 rounded-lg glass">重置</button>
            </div>
          </div>
        </div>
        <div class="table-responsive mt-3">
          <table class="min-w-full" data-mobile-table data-mobile-primary="0,3" data-mobile-title-col="3" data-mobile-detail-label="详情">
            <thead>
              <tr class="bg-white/5 text-left text-sm font-medium">
                <th class="px-4 py-3">时间</th>
                <th class="px-4 py-3">软件位</th>
                <th class="px-4 py-3">IP</th>
                <th class="px-4 py-3">卡密</th>
                <th class="px-4 py-3">机器码</th>
                <th class="px-4 py-3">事件</th>
              </tr>
            </thead>
            <tbody id="blacklist-log-list">
              <tr><td colspan="6" class="px-4 py-6 text-center text-gray-400">请选择软件位后查看黑名单记录</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 黑名单机器码 -->
    <div id="blacklist-machine-section" class="hidden">
      <div class="glass rounded-xl p-4 mb-4">
        <div class="flex flex-col gap-3">
          <div class="text-lg font-semibold flex items-center gap-2">
            <i class="fa fa-ban text-[var(--secondary)]"></i>
            <span>新增黑名单机器码</span>
          </div>
          <form id="blacklist-machine-form" class="grid md:grid-cols-4 sm:grid-cols-2 grid-cols-1 gap-3">
            <div class="md:col-span-2">
              <label class="block text-sm mb-1 text-gray-400">机器码</label>
              <input id="blacklist-machine-value" type="text" class="form-input" placeholder="请输入需要封禁的机器码" required>
            </div>
            <div>
              <label class="block text-sm mb-1 text-gray-400">类型</label>
              <select id="blacklist-machine-type" class="form-input">
                <option value="2" selected>机器码 (2)</option>
                <option value="1">IP (1)</option>
                <option value="0">其他 (0)</option>
              </select>
            </div>
            <div>
              <label class="block text-sm mb-1 text-gray-400">备注</label>
              <input id="blacklist-machine-remark" type="text" class="form-input" placeholder="可选">
            </div>
            <div class="flex items-end">
              <button type="submit" class="px-4 py-2 rounded-lg btn-primary w-full">加入黑名单</button>
            </div>
          </form>
        </div>
      </div>

      <div class="glass rounded-xl p-4">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-3">
          <div class="flex items-center gap-2">
            <i class="fa fa-database text-[var(--secondary)]"></i>
            <div>
              <div class="text-lg font-semibold">黑名单机器码列表</div>
              <div class="text-sm text-gray-400 sm:hidden">最新记录显示在最前</div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-sm text-gray-400 hidden sm:inline">最新记录显示在最前</span>
            <button id="blacklist-machine-refresh" class="px-3 py-2 rounded-lg glass">刷新</button>
            <button id="blacklist-machine-delete-selected" class="px-3 py-2 rounded-lg glass text-red-400 hover:text-red-200 disabled:opacity-50" disabled>删除选中</button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="min-w-full" data-mobile-table data-mobile-primary="0,1,3" data-mobile-actions="5" data-mobile-title-col="1" data-mobile-detail-label="详情">
            <thead>
              <tr class="bg-white/5 text-left text-sm font-medium">
                <th class="px-4 py-3 w-12"><input id="blacklist-machine-check-all" type="checkbox"></th>
                <th class="px-4 py-3">机器码 / 值</th>
                <th class="px-4 py-3">软件位</th>
                <th class="px-4 py-3">类型</th>
                <th class="px-4 py-3">备注</th>
                <th class="px-4 py-3">操作</th>
              </tr>
            </thead>
            <tbody id="blacklist-machine-list">
              <tr><td colspan="6" class="px-4 py-6 text-center text-gray-400">暂无数据</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  
  <!-- 生成结果 Modal -->
  <div id="modal-generated" class="modal-backdrop">
    <div class="modal glass rounded-xl p-5 max-w-lg">
      <div class="flex items-center justify-between mb-3">
        <div class="text-lg font-semibold">生成卡密结果</div>
        <button id="btn-close-generated" class="text-gray-400 hover:text-white"><i class="fa fa-times"></i></button>
      </div>
      <div id="generated-cards-title" class="text-sm text-gray-400 mb-2"></div>
      <div class="max-h-80 overflow-y-auto border border-white/10 rounded-lg p-3 bg-black/20">
        <div id="generated-cards-list" class="space-y-2 font-mono text-sm text-gray-200"></div>
      </div>
      <div class="mt-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
        <div id="generated-cards-count" class="text-sm text-gray-400"></div>
        <div class="flex items-center gap-2">
          <button id="btn-copy-cards" class="px-3 py-2 glass rounded-lg"><i class="fa fa-copy mr-1"></i>复制全部</button>
          <button id="btn-export-cards" class="px-3 py-2 glass rounded-lg"><i class="fa fa-file-arrow-down mr-1"></i>导出 TXT</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 新增卡密 Modal -->
  <div id="modal-create" class="modal-backdrop">
    <div class="modal glass rounded-xl p-5 max-w-lg">
      <div class="flex items-center justify-between mb-3">
        <div class="text-lg font-semibold">批量生成卡密</div>
        <button id="btn-close-create" class="text-gray-400 hover:text-white"><i class="fa fa-times"></i></button>
      </div>
      <div class="grid grid-cols-1 gap-3">
        <div>
          <label class="block text-sm mb-1 text-gray-400">卡密类型</label>
          <select id="create-cardType" class="form-input"></select>
        </div>
        <div>
          <label class="block text-sm mb-1 text-gray-400">生成数量（1-500）</label>
          <input id="create-quantity" type="number" class="form-input" value="10" min="1" max="500">
        </div>
        <div>
          <label class="block text-sm mb-1 text-gray-400">备注（可选）</label>
          <input id="create-remarks" type="text" class="form-input" placeholder="备注信息">
        </div>
        <div>
          <label class="block text-sm mb-1 text-gray-400">自定义前缀（可选，最多32位）</label>
          <input id="create-customPrefix" type="text" class="form-input" placeholder="默认使用卡密类型前缀">
        </div>
      </div>
      <div class="mt-5 flex items-center justify-end gap-2">
        <button id="btn-create" type="button" class="px-4 py-2 rounded-lg btn-primary">生成</button>
      </div>
    </div>
  </div>

  <!-- 代理：添加/加款/备注/卡类型 Modal（复用） -->
  <div id="modal-agent" class="modal-backdrop">
    <div class="modal glass rounded-xl p-5">
      <div class="flex items-center justify-between mb-3">
        <div id="agent-modal-title" class="text-lg font-semibold">操作</div>
        <button id="agent-modal-close" class="text-gray-400 hover:text-white"><i class="fa fa-times"></i></button>
      </div>
      <div id="agent-modal-body"></div>
      <div class="mt-5 flex items-center justify-end gap-2">
        <button id="agent-modal-submit" class="px-4 py-2 rounded-lg btn-primary">提交</button>
      </div>
    </div>
  </div>



  <script src="/assets/js/mobile.js"></script>
  <script src="/assets/js/app.js"></script>
</body>
</html>

